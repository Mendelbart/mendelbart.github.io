(()=>{var bt=Object.defineProperty;var M=(s,e)=>{for(var t in e)bt(s,t,{get:e[t],enumerable:!0})};var u={};M(u,{extractKeys:()=>wt,filter:()=>St,filterKeys:()=>vt,fromKeysValues:()=>xt,map:()=>ue,mapKeyArrayToValues:()=>Et,mapKeys:()=>It,onlyKeys:()=>he,subsetToBoolRecord:()=>kt,withoutKeys:()=>X});var v={};M(v,{arraysEqual:()=>ce,avg:()=>yt,bisectLeft:()=>le,cumSums:()=>ae,filterIndices:()=>Q,full:()=>Oe,range:()=>C,sum:()=>J});function ae(s){return s.map((e=>t=>e+=t)(0))}function le(s,e){let t=0,n=e.length,i;for(;t<n;)i=t+n>>1,e[i]<s?t=i+1:n=i;return t}function J(s){return s.reduce((e,t)=>e+t,0)}function yt(s){return s.length===0?(console.error("Cannot compute average of empty array."),0):J(s)/s.length}function ce(s,e){return s.length===e.length&&s.every((t,n)=>t===e[n])}function Q(s,e){return Array.from(s.entries()).filter(([t,n])=>e(n,t,s)).map(([t,n])=>t)}function C(s,e=null,t=1){e===null&&(e=s,s=0);let n=Math.ceil((e-s)/t);return Oe(n,i=>s+t*i)}function Oe(s,e){let t=new Array(s);for(let n=0;n<s;n++)t[n]=e(n);return t}function ue(s,e){return Object.fromEntries(Object.entries(s).map(([t,n],i)=>[t,e(n,t,i)]))}function St(s,e){return Object.fromEntries(Object.entries(s).filter(([t,n],i)=>e(n,t,i)))}function vt(s,e){return Object.entries(s).filter(([t,n],i)=>e(n,t,i)).map(([t,n])=>t)}function X(s,e){typeof e=="string"&&(e=[e]);let t=Object.assign({},s);for(let n of e)delete t[n];return t}function wt(s,e,t=!0){let n=e.map(i=>s[i]??null);return t&&n.push(X(s,e)),n}function he(s,e,t=!1){let n=new Set(e),i={};for(let[r,o]of Object.entries(s))n.has(r)?i[r]=o:t&&console.warn(`Filtered out key "${r}".`);return i}function It(s,e){return Object.fromEntries(Object.entries(s).map(([t,n])=>[e(t),n]))}function Et(s,e){return Object.fromEntries(s.map(t=>[t,e(t)]))}function xt(s,e,t=!0){return t&&s.length>e.length&&console.warn("More keys than values."),Object.fromEntries(e.map((n,i)=>[s[i],n]))}function kt(s,e){if(s==="none")s=[];else if(s==="all")s=e;else if(typeof s=="string")throw new Error('Invalid subset string specifier - use "none" or "all".');if(Array.isArray(s)){let t=Object.fromEntries(e.map(n=>[n,!1]));for(let n of s)t[n]=!0;return t}return ce(Object.keys(s).sort(),e.sort())||(console.log(s,e),console.warn("Subset object keys don't match keys list."),console.log(Object.keys(s).sort(),e.sort())),Object.fromEntries(e.map(t=>[t,!!s[t]]))}var l={};M(l,{addClass:()=>We,appendChildren:()=>Ft,button:()=>Lt,classIfElse:()=>U,classesToList:()=>fe,computeScaleToFit:()=>be,createElement:()=>Bt,elementSize:()=>me,forEachElement:()=>te,getARIA:()=>Ht,getTemplate:()=>de,hide:()=>j,htmlToElement:()=>At,htmlToElements:()=>je,label:()=>Ct,registerTemplate:()=>De,registerTemplates:()=>Me,removeClass:()=>Ot,scaleAllToFit:()=>Nt,scaleToFit:()=>Tt,setARIA:()=>Ut,setAttrOnKeys:()=>Pt,setAttrs:()=>Ue,setDefaultId:()=>qe,setOptions:()=>_t,setSearchParams:()=>jt,setupPages:()=>Dt,show:()=>D,showPage:()=>Z,toggleShown:()=>pe,transition:()=>ge,uniqueIdPrefix:()=>He});var Re=0;window.hasTouch="ontouchstart"in window;var ee={};function Me(s){for(let[e,t]of Object.entries(s))De(e,t)}function De(s,e){s in ee&&console.warn(`Overwriting existing template key ${s}.`);let t=document.createElement("TEMPLATE");typeof e=="string"?t.insertAdjacentHTML("beforeend",e):t.append(e),ee[s]=t}function de(s){return s in ee||console.error("Unknown template key "+s),ee[s].firstChild.cloneNode(!0)}Me({buttonLabel:'<label class="button"></label>',buttonInput:'<input class="button-check form-input" autocomplete="off">'});function Lt(s,e,t=null,n=null){let i=de("buttonInput"),r=de("buttonLabel");return n??=He("button")+e,Ue(i,{type:s,value:e,id:n}),r.setAttribute("for",n),t&&(typeof t=="string"&&(t=document.createTextNode(t)),r.appendChild(t)),[i,r]}function Ct(s,e,t=null){let n=document.createElement("LABEL");return s instanceof Node&&(s=qe(s,t)),n.setAttribute("for",s),n.textContent=e,n}function je(s){let e=document.createElement("TEMPLATE");return e.innerHTML=s,e.content.children}function At(s){let e=je(s);if(e.length!==1)throw new Error("HTML doesn't contain exactly one element.");return e[0]}function Bt(s){let[e,...t]=s.split("."),[n,i]=e.split("#"),r=document.createElement(n);return i&&(r.id=i),r.classList.add(...t),r}function _t(s,e,{selected:t=null,disabled:n=[],groups:i=[]}={}){t??=Object.keys(e)[0];let r=ue(e,()=>!1),o=null;for(let{label:a,keys:c}of i){let h=document.createElement("OPTGROUP");h.label=a;for(let d of c){if(!(d in e)){console.warn(`Unknown grouped key ${d} in group ${a}.`);continue}h.append(Te(d,e[d],t,n)),r[d]=!0}s.add(h),o||(o=h)}for(let[a,c]of Object.entries(e))r[a]||s.add(Te(a,c,t,n),o)}function Te(s,e,t,n){let i=document.createElement("OPTION");return i.value=s,i.textContent=e,t===s&&(i.selected="selected"),n.includes(s)&&(i.disabled="disabled"),i}function Ft(s,e){for(let t of e)s.appendChild(t)}function Pt(s,e,t,n=""){if(e){typeof e=="string"&&(e=[e]);for(let i of e)s[i].setAttribute(t,n)}}function Ue(s,e){for(let[t,n]of Object.entries(e))typeof n=="boolean"?n?s.setAttribute(t,t):s.removeAttribute(t):t==="class"?We(s,n):s.setAttribute(t,n)}function He(s,e="_"){return Re+=1,s+Re+e}function qe(s,e){return s.hasAttribute("id")?(s.id=e,e):s.id}function te(s,e){if(s)if(s instanceof Node)e(s);else for(let t of s)e(t)}function U(s,e,t,n=null){s||([t,n]=[n,t]),t=fe(t),n=fe(n),te(e,i=>{i.classList.remove(...n),i.classList.add(...t)})}function We(s,e){U(!0,s,e)}function Ot(s,e){U(!1,s,e)}function D(s,e="display"){te(s,t=>{t.style.removeProperty(e)})}var Rt={display:"none",visibility:"hidden",opacity:"0"};function j(s,e="display"){te(s,t=>{t.style.setProperty(e,Rt[e])})}function pe(s,e,t=null,n="display"){s?(t&&j(t,n),D(e,n)):(j(e,n),t&&D(t,n))}function fe(s){return s??=[],typeof s=="string"?s.split(" "):Array.from(s)}function me(s,e="border-box",t=!1){let n=t?s.scrollWidth:s.clientWidth,i=t?s.scrollHeight:s.clientHeight,r=window.getComputedStyle(s),o=r.scale;return!o||o==="none"?o=1:o=parseFloat(o),e==="border-box"?(n+=o*(parseFloat(r.borderLeftWidth||0)+parseFloat(r.borderRightWidth||0)),i+=o*(parseFloat(r.borderTopWidth||0)+parseFloat(r.borderBottomWidth||0))):e==="content-box"?(n-=o*(parseFloat(r.paddingLeft||0)+parseFloat(r.paddingRight||0)),i-=o*(parseFloat(r.paddingTop||0)+parseFloat(r.paddingBottom||0))):e!=="padding-box"&&console.error("Invalid value for element size box, use padding-box, content-box or border-box."),[n,i]}function be(s,{container:e=null,dimension:t="width",elementBox:n="border-box",containerBox:i="content-box",grow:r=!1}={}){e??=s.parentElement;let[o,a]=me(s,n,!0),[c,h]=me(e,i),d=Ne(o,c,r),m=Ne(a,h,r);return["width","height","both"].includes(t)||(console.error("Invalid dimension, use 'width', 'height' or 'both'."),t="width"),t==="width"?d:t==="height"?m:Math.min(d,m)}function Tt(s,e={}){s.style.scale=be(s,e)}function Nt(s,e={}){if(Array.isArray(s)||(s=Array.from(s)),s.length===0)return;let t=s.map(n=>be(n,e));t=Mt(t,e.maxScaleRatio??1/0);for(let[n,i]of s.entries())i.style.scale=t[n]}function Mt(s,e=1/0){if(e===1/0)return s;let t=Math.min(...s),n=Math.max(...s);if(t===0||n/t<=e)return s;let i=Math.log(e)/Math.log(n/t);return s.map(r=>(r/t)**i*t)}function Ne(s,e,t=!1){if(s===0)return console.warn("getScale: Element's size is 0."),1;if(isNaN(s))return console.error("Element size is NaN."),1;if(isNaN(e))return console.error("Container size is NaN."),1;let n=e/s;return t?n:Math.min(n,1)}function Dt(s){Z(s.querySelector(".page-content"),s),s.querySelector(".pages-next-button").addEventListener("click",()=>ge(()=>Z(document.getElementById(s.dataset.openPage).nextElementSibling,s))),s.querySelector(".pages-back-button").addEventListener("click",()=>ge(()=>Z(document.getElementById(s.dataset.openPage).previousElementSibling,s)))}function Z(s,e=null){e??=s.closest(".pages-container"),j(e.querySelectorAll(".page-content")),j(e.querySelectorAll(".page-heading")),D(s),D(e.querySelector(`.page-heading[data-for="${s.id}"]`)),e.dataset.openPage=s.id,pe(!!s.previousElementSibling,e.querySelector(".pages-back-button")),pe(!!s.nextElementSibling,e.querySelector(".pages-next-button"),e.querySelector(".pages-finish-button")),s.nextElementSibling||e.querySelector(".pages-finish-button").focus()}function jt(s){let e=new URL(location),t=!1;for(let[n,i]of Object.entries(s)){let r=encodeURIComponent(i);e.searchParams.get(n)!==r&&(e.searchParams.set(n,r),t=!0)}t&&history.pushState({},"",e)}function ge(s,e=[]){document.startViewTransition?document.startViewTransition({update:()=>s(),types:e}):requestAnimationFrame(()=>s())}function Ut(s,e,t){s.setAttribute("aria-"+e,t)}function Ht(s,e){return s.getAttribute("aria-"+e)}function qt(s){let e=1779033703,t=3144134277,n=1013904242,i=2773480762;for(let r=0;r<s.length;r++){let o=s.charCodeAt(r);e=t^Math.imul(e^o,597399067),t=n^Math.imul(t^o,2869860233),n=i^Math.imul(n^o,951274213),i=e^Math.imul(i^o,2716044179)}return e=Math.imul(n^e>>>18,597399067),t=Math.imul(i^t>>>22,2869860233),n=Math.imul(e^n>>>17,951274213),i=Math.imul(t^i>>>19,2716044179),e^=t^n^i,t^=e,n^=e,i^=e,[e>>>0,t>>>0,n>>>0,i>>>0]}function Wt(s,e,t,n){return function(){s|=0,e|=0,t|=0,n|=0;let i=(s+e|0)+n|0;return n=n+1|0,s=e^e>>>9,e=t+(t<<3)|0,t=t<<21|t>>>11,t=t+i|0,(i>>>0)/4294967296}}function Vt(s){return Wt(...qt(s))}var H=class{constructor(s=Math.random){this._rand=s}rand(s=null,e=null){return e===null?this._rand()*(s??1):(s??=0,this._rand()*(e-s)+s)}seed(s){this._rand=Vt(s)}randInt(s,e){return Math.floor(this.rand(s,e))}shuffle(s){for(let e=s.length;e>0;e--){let t=this.randInt(e);t!==e-1&&([s[e-1],s[t]]=[s[t],s[e-1]])}}randIndexFromWeights(s){let e=ae(s);return le(this.rand(e[e.length-1]),e)}};var w={};M(w,{clearFont:()=>Ye,getFontData:()=>Qt,loadFont:()=>Se,loadFonts:()=>ve,setFont:()=>ze,setFontProperties:()=>Ie,supportsStylesets:()=>we,supportsVariableFonts:()=>$e});var Ve=[{family:"Noto Serif Hebrew",scale:1.25,shift:-.05,fallback:"serif",variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Sans Hebrew",scale:1.25,shift:-.15,variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Rashi Hebrew",scale:1.25,shift:-.05,fallback:"serif",variationSettings:{wght:"100 900"}},{family:"Noto Serif",fallback:"serif",variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Sans",variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Sans Japanese",shift:-.06,variationSettings:{wght:"100 900"}},{family:"Noto Serif Japanese",fallback:"serif",shift:-.06,variationSettings:{wght:"100 900"}},{family:"Noto Sans Arabic",scale:.94,variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Kufi Arabic",variationSettings:{wght:"100 900"}},{family:"Noto Naskh Arabic",variationSettings:{wght:"400 700"}},{family:"Noto Sans Phoenician"},{family:"Junicode",fallback:"serif",variationSettings:{wght:"300 700",wdth:"100",ENLA:"0"},styleset:{"Early-English-futhorc":12,"Elder-futhark":13,"Younger-futhark":14,"Long-branch-to-short-twig":15,"Latin-to-Gothic":19}}];var F=Object.fromEntries(Ve.map(s=>[s.family,s])),Kt={display:"swap",weight:400,style:"normal"},ne={},ye={family:"font-family",weight:"font-weight",scale:"--font-scale",shift:"--font-shift",styleset:"font-variant-alternates",letterSpacing:"--letter-spacing",lineHeight:"--line-height"},Ge=["shift","scale","letterSpacing"];function Se(s){return s?typeof s=="object"?Se(s.family):(s in ne||(ne[s]=zt(s),document.fonts.add(ne[s])),ne[s].load()):Promise.reject("No family given.")}function ve(s){return Promise.all(s.map(e=>Se(e)))}function $t(s){let e=`/kadmos/assets/fonts/${s.replaceAll(" ","")}.woff2`,t=$e()?"woff2-variations":"woff2";return`url("${e}") format("${t}")`}function Ke(){return"CSS"in window&&"supports"in CSS}function we(){return Ke()&&CSS.supports("font-variant-alternates","styleset(x)")}function $e(){return Ke()&&CSS.supports("font-variation-settings","normal")}function zt(s){let e=Object.assign({},Kt,F[s]);if("styleset"in e&&we()&&(document.styleSheets[0].insertRule(`@font-feature-values "${s}" {@styleset {`+Object.entries(e.styleset).map(([t,n])=>`${t}: ${n};`).join("")+"}}"),delete e.styleset),"variationSettings"in e){let t=Yt(e.variationSettings);delete e.variationSettings,Object.assign(e,t)}return new FontFace(s,e.url??$t(s),e)}function Yt(s){let e={};return"wght"in s&&(e.weight=s.wght,s=X(s,"wght")),Object.keys(s).length>0&&(e.variationSettings=Object.entries(s).map(([t,n])=>`"${t}" ${n}`).join(",")),e}function ze(s,e,t=null){if(typeof e=="object")if("family"in e&&typeof e.family=="string"){ze(s,e.family,e);return}else throw new Error("Need properties.family of type string if family argument is omitted.");if(!(e in F))throw new Error(`Unknown family ${e}.`);Ye(s),Xt(s,e),Ie(s,Jt(t,e))}function Jt(s,e){let t=Object.assign({},s),n=F[e];return"shift"in n&&(t.shift=n.shift+(s.shift??0)),"scale"in n&&(t.scale=n.scale*(s.scale??1)),t}function Qt(s){return F[s]}function Ie(s,e){let t=!1;for(let[n,i]of Object.entries(e))if(n!=="family"){if(!(n in ye)){console.warn(`Unknown font property '${n}'`);continue}Ge.includes(n)&&(t=!0),n==="styleset"?"family"in e?Zt(s,i,e.family):console.error("Cannot set styleset without knowing family."):s.style.setProperty(ye[n],i)}U(t,s,"font-transform")}function Xt(s,e){let t=F[e];s.style.fontFamily=e+", "+(t.fallback??"system-ui, sans-serif"),Ie(s,he(t,Ge))}function Ye(s){for(let e of Object.values(ye))s.style.removeProperty(e)}function Zt(s,e,t){e=Array.isArray(e)?e:[e];let n=`styleset(${e.join(", ")})`;if(we())s.style.setProperty("font-variant-alternates",n);else{let r=e.map(o=>F[t].styleset[o]).map(o=>`"ss${o.toString().padStart(2,"0")}"`).join(", ");s.style.setProperty("font-feature-settings",r)}}var q={};M(q,{decodeBase64BoolArray:()=>tn,decodeBase64Number:()=>Qe,encodeBase64BoolArray:()=>en,encodeBase64Number:()=>Je});function en(s){return Xe(nn(s))+"~"+Je(s.length)}function tn(s){let[e,t]=s.split("~");return sn(Ze(e),Qe(t))}function Je(s){return Xe(rn(s))}function Qe(s){return on(Ze(s))}function nn(s){let e=new Array(Math.ceil(s.length/6)),t;for(let n=0;n<e.length;n++){t=0;for(let i=0;i<6;i++)s[6*n+i]&&(t+=1<<i);e[n]=t}return e}function sn(s,e){if(Math.ceil(e/6)!==s.length)throw new Error("Lengths of base 64 values and resultant length don't match.");let t=new Array(e);for(let[n,i]of s.entries())for(let r=0;r<6;r++){let o=6*n+r;if(o>=e)break;t[o]=(i&1<<r)!==0}return t}function rn(s){let e=[];for(;s>0;)e.push(s&63),s>>=6;return e}function on(s){let e=0;for(let[t,n]of s.entries())e+=n<<6*t;return e}function Xe(s){return String.fromCharCode(...s.map(e=>an(e)))}function Ze(s){let e=new Array(s.length);for(let t=0;t<s.length;t++)e[t]=ln(s.charCodeAt(t));return e}function an(s){return s&=63,s<26?s+65:s<52?s+71:s<62?s+-5:s===62?45:95}function ln(s){if(s>=65&&s<91)return s-65;if(s>=97&&s<123)return s-97+26;if(s>=48&&s<58)return s-48+53;if(s===45)return 62;if(s===95)return 63;throw new Error("Unknown base 64 char code.")}var g=class{constructor(){this._funcs=new Set}push(...e){for(let t of e)this._funcs.add(t)}remove(e){this._funcs.delete(e)}call(...e){for(let t of this._funcs)t.call(...e)}clear(){this._funcs.clear()}};var b=class{constructor(){this.settings={},this.keys=[]}static createFrom(e,t=null){let n=new this;return n.put(e,t),n}put(e,t=null){t??=Object.keys(e);for(let n of t)this.add(n,e[n])}extend(e){this.put(e.settings,e.keys)}add(e,t,n="end",i=null){if(this.settings[e]=t,n==="end")this.keys.push(e);else{let r;n==="begin"?r=0:(r=this.keys.indexOf(i),n==="afterKey"?r++:n!=="beforeKey"&&console.error("Invalid insert setting insert position.")),this.keys.splice(r,0,e)}}remove(e){this.settings[e].remove(),delete this.settings[e]}removeAll(){for(let e of Object.values(this.settings))e.remove();this.settings={},this.keys=[]}replace(e,t){this.settings[e].node.replaceWith(t.node),this.settings[e].remove(),this.settings[e]=t}replaceSelf(e){this.removeAll(),this.put(e.settings)}getValues(){return u.map(this.settings,e=>e.value)}setValues(e){for(let[t,n]of Object.entries(e))this.settings[t].value=n}getValue(e){if(!(e in this.settings))throw new Error("Key not in settings collection.");return this.settings[e].value}getDefault(e,t=null){return e in this.settings?this.settings[e].value:t}getNode(e){return this.settings[e].node}getSetting(e){return this.settings[e]}nodeList(){return this.keys.map(e=>this.settings[e].node)}addUpdateListener(e,...t){if(typeof e=="function")for(let n of Object.values(this.settings))n.updateListeners.push(e,...t);else{typeof e=="string"&&(e=[e]);for(let n of e)this.settings[n].updateListeners.push(...t)}}},B=class{static idCount=0;static updateEvent="change";node;valueNode;updateListeners;constructor(e){let t;if(this.constructor.isValueNode(e))t=e;else if(t=e.querySelector("input, textarea, select"),!this.constructor.isValueNode(t))throw new Error("Couldn't find element of type input, textarea or select.");this.node=l.createElement("div.setting.labeled-value-element"),this.node.append(e),this.valueNode=t,this.updateListeners=new g,this._onChange=this._onChange.bind(this),this.valueNode.addEventListener(this.constructor.updateEvent,this._onChange)}static createInput(e,t=null,n=null){let i=document.createElement("INPUT");i.type=e,n&&l.setAttrs(i,n);let r=new this(i);return t&&r.label(t),r}static createSelect(e,t={}){let n=document.createElement("select");l.setOptions(n,e,t);let i=l.createElement("div.styled-select");i.append(n);let r=new this(i);return t.id&&r.setId(t.id),t.label&&r.label(t.label),r}static isValueNode(e){let t=e.tagName;return t==="SELECT"||t==="TEXTAREA"||t==="INPUT"&&e.type!=="hidden"}isCheckbox(){return this.valueNode.tagName==="INPUT"&&this.valueNode.type==="checkbox"}get value(){return this.isCheckbox()?this.valueNode.checked:this.valueNode.value}set value(e){this.isCheckbox()?this.valueNode.checked=e:this.valueNode.value=e}_onChange(){this.updateListeners.call(this,this.value)}setDisabled(e){this.valueNode.disabled=e}setId(e={prefix:""}){let t=typeof e=="string"?e:this.constructor.generateId(e.prefix);this.valueNode.id=t;let n=this.node.querySelector("label");return n&&(n.htmlFor=t),t}static generateId(e=""){return"ve_"+e+this.idCount.toString().padStart(4,"0")}label(e){if(!e)return;let t=this.node.querySelector("label");t||(t=document.createElement("label"),this.valueNode.id||this.setId(),t.htmlFor=this.valueNode.id,this.node.prepend(t)),t.textContent=e}remove(){this.valueNode.removeEventListener(this.constructor.updateEvent,this._onChange),this.node.remove()}};l.registerTemplate("buttonGroupContainer",l.createElement("fieldset.button-group"));var x=class{static nameCount=0;node;inputs;constructor(e,t,n=!1){this.node=e,this.updateListeners=new g,this.inputs=Object.fromEntries(Array.from(this.node.querySelectorAll("INPUT")).map(i=>[i.value,i])),this.exclusive=t,this.decheckable=n,this._onChange=this._onChange.bind(this),this.node.addEventListener("change",this._onChange)}static from(e,{exclusive:t=!1,name:n=null,checked:i=null,disabled:r=null,decheckable:o=!1,label:a=null}={}){Array.isArray(e)&&(e=Object.fromEntries(e.map(f=>[f,f])));let c=Object.keys(e),h=t?"radio":"checkbox";n??=this.generateName();let d=l.getTemplate("buttonGroupContainer");t&&(d.setAttribute("role","radiogroup"),typeof i=="string"&&(i=[i]),!o&&!i&&(i=[c[0]])),i=u.subsetToBoolRecord(i??"none",c),r=u.subsetToBoolRecord(r??"none",c);for(let[f,A]of Object.entries(e)){let[I,Y]=l.button(h,f,A);I.name=t?n:`${n}_${f}`,I.disabled=r[f],I.checked=i[f],d.append(I,Y)}t&&o&&d.addEventListener("click",f=>{f.target.tagName==="INPUT"&&f.target.checked&&(f.target.checked=!1)});let m=new this(d,t,o);return a&&m.label(a),m}static generateName(){return this.nameCount++,"buttongroup_"+this.nameCount.toString().padStart(4,"0")}_onChange(){this.updateListeners.call(this,this.value)}buttonCount(){return Object.keys(this.inputs).length}disableIfSingleButton(e=null){this.buttonCount()===1?(this.setDisabled(!0),e!==null&&(this.value=e?Object.keys(this.inputs):[])):this.setDisabled(!1)}get value(){return u.filterKeys(this.inputs,e=>e.checked)}set value(e){e=u.subsetToBoolRecord(e,Object.keys(this.inputs));for(let[t,n]of Object.entries(this.inputs))n.checked=e[t]}setDisabled(e){for(let t of Object.values(this.inputs))t.disabled=e}label(e){let t=document.createElement("LEGEND");t.textContent=e,this.node.prepend(t)}remove(){this.node.addEventListener("change",this._onChange),this.node.remove()}};l.registerTemplate("slider",`<div class="slider-container">
    <span class="range-min"></span><span class="range-value"></span><span class="range-max"></span>
    <input type="range" class="form-range">
</div>`);var P=class extends B{static updateEvent="input";constructor(e,t,n){if(super(e),this.valueNode.tagName!=="INPUT"||this.valueNode.type!=="range")throw new Error("Couldn't find input type='range' element.");this.min=t,this.max=n,this.displayValue=this.displayValue.bind(this),this.updateProgress=this.updateProgress.bind(this),this.displayMinMax()}static create(e,t,n=null){let i=l.getTemplate("slider"),r=i.lastElementChild;r.min=e,r.max=t,r.setAttribute("step",1);let o=new this(i,e,t);return n!==null&&(o.value=n),o}_onChange(){super._onChange(),this.updateProgress(),this.displayValue()}updateProgress(){this.valueNode.style.setProperty("--range-progress",this.getProgress().toString())}getProgress(){return(this.value-this.min)/(this.max-this.min)}displayValue(){this.node.querySelector(".range-value").textContent=this.formatValue(this.value)}displayMinMax(){this.node.querySelector(".range-min").textContent=this.formatValue(this.min),this.node.querySelector(".range-max").textContent=this.formatValue(this.max)}isCheckbox(){return!1}set value(e){(this.min>e||this.max<e)&&console.warn("Slider value outside range."),super.value=e.toString(),this.displayValue(),this.updateProgress()}get value(){return parseFloat(this.valueNode.value)}formatValue(e){return(Math.round(e*100)/100).toString()}setMin(e){this.valueNode.value<e&&(this.valueNode.value=e,this._onChange()),this.min=e,this.valueNode.min=e,this.updateProgress(),this.displayMinMax()}setMax(e){this.valueNode.value>e&&(this.valueNode.value=e,this._onChange()),this.max=e,this.valueNode.max=e,this.updateProgress(),this.displayMinMax()}};var se=class{_punishFactor=2;_manualPunish=1;_previousDampFactor=.5;constructor(e){this.items=e,this.rng=new H;let t=this.itemCount=e.length;this.hitCount=0,this.scores=new Array(t).fill(0),this.tries=new Array(t).fill(0),this.triesLeft=new Array(t).fill(1),this.totalTriesLeft=t,this.maxTriesLeft=t,this.currentIndex=this.rng.randInt(0,t),this.previousIndex=null}seed(e){this.rng.seed(e)}currentItem(){return this.items[this.currentIndex]}nextItem(){return this.previousIndex=this.currentIndex,this.currentIndex=this.rng.randIndexFromWeights(this.getWeights()),this.currentItem()}getWeights(){let e=this.triesLeft.slice();return this.previousIndex!==null&&(e[this.previousIndex]*=this._previousDampFactor),e}updateTotalTriesLeft(){let e=v.sum(this.triesLeft);e>this.totalTriesLeft&&(this.maxTriesLeft+=e-this.totalTriesLeft),this.totalTriesLeft=e}progress(){return 1-this.totalTriesLeft/this.maxTriesLeft}enterScore(e){let t=++this.tries[this.currentIndex];t===1&&this.hitCount++,this.scores[this.currentIndex]=Math.max(this.scores[this.currentIndex],e*this.scoreAtTryFactor(t)),this.triesLeft[this.currentIndex]+=this._triesBoost(e)-1,this.triesLeft[this.currentIndex]<=0&&(this.triesLeft[this.currentIndex]=0,this.itemCount--),this.updateTotalTriesLeft()}isEmpty(){return this.itemCount===0}_triesBoost(e){return this._punishFactor*(1-e)}scoreAtTryFactor(e){return 1/e}getItemIndex(e){return this.items.indexOf(e)}punish(e,t=1){this.triesLeft[e]+=this._manualPunish*t,this.updateTotalTriesLeft()}absoluteScore(){return v.sum(this.scores)}scoreString(e="ratio"){let t=this.absoluteScore(),n=`${tt(t,1,2)}/${this.hitCount}`,i=this.hitCount>0?et(t/this.hitCount):et(0);if(e==="ratio")return n;if(e==="percent")return i;if(e==="both")return`${n} (${i})`;console.error(`Unknown mode: ${e}`)}};function et(s,e=0){return String(tt(s*100,e))+"%"}function tt(s,e=0,t=1){let n=Math.pow(10,e)*t;return Math.floor(s*n)/n}function W(s,e,t,n,i){return s<e||t<e?s>t?t+1:s+1:n===i?e:e+1}function Ee(s,e){if(s===e)return 0;if(s.length>e.length){let gt=s;s=e,e=gt}let t=s.length,n=e.length;for(;t>0&&s.charCodeAt(t-1)===e.charCodeAt(n-1);)t--,n--;let i=0;for(;i<t&&s.charCodeAt(i)===e.charCodeAt(i);)i++;if(t-=i,n-=i,t===0||n<3)return n;let r=0,o,a,c,h,d,m,f,A,I,Y,_e,Fe,E=new Array(2*t);for(o=0;o<t;o++)E[2*o]=o+1,E[2*o+1]=s.charCodeAt(i+o);let Pe=E.length-1;for(;r<n-3;)for(I=e.charCodeAt(i+(a=r)),Y=e.charCodeAt(i+(c=r+1)),_e=e.charCodeAt(i+(h=r+2)),Fe=e.charCodeAt(i+(d=r+3)),m=r+=4,o=0;o<Pe;o+=2)f=E[o],A=E[o+1],a=W(f,a,c,I,A),c=W(a,c,h,Y,A),h=W(c,h,d,_e,A),m=W(h,d,m,Fe,A),E[o]=m,d=h,h=c,c=a,a=f;for(;r<n;)for(I=e.charCodeAt(i+(a=r)),m=++r,o=0;o<Pe;o+=2)f=E[o],E[o]=m=W(f,a,m,I,E[o+1]),a=f;return m}var O=class{constructor(e,t,n,i){this.type=e,this.displayString=t,this.properties=n,this.form=i}},k=class{constructor(e,t){this.value=e,this.maxDist=t,this.displayString=typeof e=="string"?e:e.toString()}static fromData(e,t){let n=t.maxDist??0,i=t.type;if(i==="number")return new xe(e,n,t.distanceMode??"linear");if(i==="string")return new ie(e,n,t.caseSensitive??!1,t.substitutions??{});if(i==="list"){let r,o={};return typeof e=="string"?r=e:("source"in e||console.error("Source of list property missing."),r=e.source,"alts"in e&&(o=e.alts)),new V(r,n,o,t)}else console.error(`Unknown property type "${t.type}"`)}grade(e){let t=this.gradeSingle(e,this.value);return[t,e.length>0?[this.markGradedText(e,t)]:[],[this.markGradedText(this.displayString,t)]]}static passes(e){return e>=.5}gradeSingle(e,t){let n=this.distance(e,t);return n<=this.maxDist?this.maxDist===0?1:Math.pow(2,-n/this.maxDist):0}markGradedText(e,t){let n=document.createElement("SPAN");return n.dataset.correct=t===1?"true":t>0?"partially":"false",n.textContent=e,n}distance(e,t){console.error("Not implemented.")}},xe=class extends k{constructor(e,t,n="linear"){let i,r;typeof e=="string"?(i=parseFloat(e),isNaN(i)&&console.error(`Invalid number property value "${e}"`),r=e):(i=e,r=e.toString()),n==="log"&&i===0&&console.error('Invalid value 0 for NumberProperty with distanceMode "log"'),super(i,t),this.displayString=r,this.distanceMode=n}distance(e,t){return this.distanceMode==="linear"?Math.abs(e-t):Math.abs(Math.log(e/t))}},ie=class extends k{constructor(e,t,n=!1,i={}){super(e,t),this.caseSensitive=n,this.substitutions=i}distance(e,t){return Ee(this.standardizeString(e),this.standardizeString(t))}standardizeString(e){e=e.trim();for(let[t,n]of Object.entries(this.substitutions))e=e.replaceAll(new RegExp(t,"g"),n);return e=e.normalize("NFKD").replaceAll(/\p{M}/gu,""),this.caseSensitive||(e=e.toLowerCase()),e}},V=class extends ie{constructor(e,t,n={},{listMode:i="best",caseSensitive:r=!1,splitter:o="[,;/]",excludeFromList:a=["\\(.*?\\)"],substitutions:c={}}){e=e.trim(),super(e,t,r,c),this.splitter=o,this.values=this.constructor.getValues(e,t,this.splitter,a),n?this.alternatives=u.map(n,h=>typeof h=="string"?[h]:h):this.alternatives={},this.listMode=i}static getValues(e,t,n,i){let r=[new re(e)];for(let o of[...i,n])r=r.map(a=>a.split(o)).flat().map(a=>a.trim()).filter(a=>a.end>a.start);return r.length===0&&console.warn("No values in list."),r}grade(e){let t=new re(e).split(this.splitter).map(o=>o.trim()),n=new Array(t.length).fill(0),i=new Array(this.values.length).fill(0);for(let[o,a]of this.values.entries())for(let[c,h]of t.entries()){let d=this.gradeSingle(h.str,a.str);a.str in this.alternatives&&(d=Math.max(d,...this.alternatives[a.str].map(m=>this.gradeSingle(h.str,m)))),d>0&&(i[o]=Math.max(i[o],d),n[c]=Math.max(n[c],d))}return[this.listMode==="best"?Math.max(...i):v.avg(n),this.markSubStrings(t,n),this.markSubStrings(this.values,i)]}markSubStrings(e,t){if(e.length===0)return[];let n=e[0].source,i=[],r=0;for(let[o,a]of e.entries())r<a.start&&i.push(document.createTextNode(n.substring(r,a.start))),a.start<a.end&&(i.push(this.markGradedText(a.str,t[o])),r=a.end);return r<n.length&&i.push(document.createTextNode(n.substring(r))),i}},re=class s{constructor(e,t=0,n=null){e instanceof s&&(t+=e.start,n===null?n=e.end:n+=e.start,e=e.source),n===null&&(n=e.length),this.source=e,this.str=e.substring(t,n),this.start=t,this.end=n}split(e,t=!1){let n=[],i=this.str.matchAll(e),r=0;for(let o of i)!t&&r===o.index||(n.push(new this.constructor(this,r,o.index)),r=o.index+o[0].length);return(t||r<this.end-this.start)&&n.push(new this.constructor(this,r)),n}trim(){let e=this.str.match(/^\s*/)[0].length,t=this.str.match(/\s*$/)[0].length;return e===0&&t===0?this:new this.constructor(this.source,this.start+e,this.end-t)}};l.registerTemplates({eval:`<div class="item-eval">
    <span class="submitted"></span><span class="solution"></span>
</div>`,symbolContainer:`<div class="symbol-container">
    <div class="symbol-display-container"><span class="symbol"></span></div>
    <div class="symbol-label-container"><span class="symbol-label"></span></div>
</div>`});var G=class{constructor(e,t,n,i,r=null){this.dataset=e,this.properties=n,this.language=i,this.dealer=new se(t),this.onFinish=new g,this.variant=r,this.updateProgressBar(),this.onInputKeydown=this.onInputKeydown.bind(this),this._show=this._show.bind(this),this.loadAndUpdateSymbolFont=this.loadAndUpdateSymbolFont.bind(this)}static genericSettings(){return b.createFrom({seed:B.createInput("text","Seed (optional)",{id:"game-seed"})})}setup({defaultWeight:e=null}={}){return this.setupSymbolContainer(),this.setupInputs(),this.setupEvals(),document.getElementById("item-next-button").textContent="Next",this.setupFontSettings(e)}getInputMode(e){return e==="real"||e==="integer"?"numeric":"text"}setupSymbolContainer(){let e=document.querySelector("#symbol-current .symbol");e.classList.add("symbol-string"),e.setAttribute("lang",this.dataset.metadata.lang),e.setAttribute("dir",this.dataset.metadata.dir)}setupInputs(){this.inputs=u.mapKeyArrayToValues(this.properties,t=>{let n=document.createElement("INPUT");return l.setAttrs(n,{type:"text",inputmode:this.getInputMode(this.dataset.properties[t].type),placeholder:this.dataset.properties[t].label}),this.language&&this.language!=="default"&&n.setAttribute("lang",this.language),n});let e=document.getElementById("game-inputs");e.replaceChildren(...Object.values(this.inputs)),e.addEventListener("keydown",this.onInputKeydown)}onInputKeydown(e){let t=e.target.closest("INPUT");t&&(e.key==="Enter"?t.nextElementSibling?t.nextElementSibling.focus():document.getElementById("item-submit-button").focus():e.key==="Backspace"&&e.target.value===""&&t.previousElementSibling&&(t.previousElementSibling.focus(),e.preventDefault()))}setupEvals(){this.evals={};let e=document.getElementById("game-evals");for(let t of this.properties){let n=l.getTemplate("eval");this.evals[t]=n,e.append(n)}}updateSymbolWeight(e){document.querySelector("#game-symbols").style.setProperty("--symbol-weight",e.toString())}loadAndUpdateSymbolFont(e=null){return e??=this.fontSettings.getValue("family"),w.loadFont(this.dataset.getFont(e,this.variant)).then(()=>this.updateSymbolFontFamily(e)).catch(t=>console.error(t))}updateSymbolFontFamily(e){e??=this.fontSettings.getValue("family"),document.querySelectorAll("#game-symbols .symbol-string").forEach(t=>{this.setSymbolFont(t,e)}),this.updateSymbolWeightRange(e)}updateSymbolWeightRange(e){let t=this.dataset.getFont(e,this.variant).family,n=w.getFontData(t),i=this.fontSettings.getSetting("weight");if(n.variationSettings&&n.variationSettings.wght){let[r,o]=n.variationSettings.wght.split(" ").map(a=>parseInt(a,10));i.setMin(r),i.setMax(o),l.show(i.node)}else l.hide(i.node)}setupFontSettings(e){e??=500;let t=P.create(100,900,e);return t.label("Weight"),this.fontSettings=b.createFrom({family:this.dataset.fontFamilySetting(),weight:t}),document.querySelector("#font-settings").replaceChildren(...this.fontSettings.nodeList()),this.fontSettings.addUpdateListener("weight",this.updateSymbolWeight),this.fontSettings.addUpdateListener("family",()=>l.transition(this.loadAndUpdateSymbolFont)),this.updateSymbolWeight(e),this.loadAndUpdateSymbolFont()}setSymbolFont(e,t){w.setFont(e,this.dataset.getFont(t,this.variant))}setReferenceItems(e){this.referenceItems=e}seed(e){this.dealer.seed(e)}cleanup(){this.clearItemDisplay(),this.updateProgressBar(0),document.getElementById("game-inputs").removeEventListener("keydown",this.onInputKeydown),document.getElementById("game-inputs").replaceChildren(),document.getElementById("game-evals").replaceChildren()}finish(){setTimeout(()=>this.cleanup(),100),this.onFinish.call(this)}currentItem(){return this.dealer.currentItem()}submitRound(){let e=0,t=this.currentItem();for(let[n,i]of Object.entries(this.inputs)){let r=this.evals[n],o=t.properties[n],[a,c,h]=o.grade(i.value);if(e+=a,!k.passes(a)){let d=this.getReferenceItems(t.form,n,i.value);if(d.length>0){let m=this.referenceItemsNodes(d,n);document.getElementById("game-symbols").append(...m),this.updateSymbolFontFamily(this.fontSettings.getValue("family"));for(let f of m)this.scaleItemNodeContents(f);for(let f of d)this.dealer.punish(this.dealer.getItemIndex(f),1/d.length)}}r.querySelector(".submitted").replaceChildren(...c),r.querySelector(".solution").replaceChildren(...h),l.classIfElse(o instanceof V&&o.listMode==="best",r,"best-mode")}e/=this.properties.length,this.dealer.enterScore(e),this.updateProgressBar(),this.dealer.isEmpty()&&(document.getElementById("item-next-button").textContent="Finish"),this.show("evals"),window.scrollY>0&&window.scrollTo({top:0,behavior:"smooth"})}getReferenceItems(e,t,n){if(!this.referenceItems)return[];let i=[];for(let[r,o]of this.referenceItems[e].entries()){let a=o.properties[t].grade(n)[0];k.passes(a)&&i.push([r,a])}return i.sort(([r,o],[a,c])=>c-o||r-a),i.length>0&&i[0][1]===1&&(i=i.filter(([r,o])=>o===1)),i.map(([r,o])=>this.referenceItems[e][r])}referenceItemsNodes(e,t){return e.map(n=>this.referenceItemNode(n,t))}referenceItemNode(e,t){let n=l.getTemplate("symbolContainer");return n.classList.add("symbol-reference"),n.querySelector(".symbol").classList.add("symbol-string"),this.updateItemNode(n,e,t,!1),n}updateItemNode(e,t,n=null,i=!0){n??=this.properties[0],e.querySelector(".symbol").textContent=t.displayString,e.querySelector(".symbol-label").textContent=t.properties[n].displayString,i&&this.scaleItemNodeContents(e)}scaleItemNodeContents(e){l.scaleToFit(e.querySelector(".symbol")),l.scaleToFit(e.querySelector(".symbol-label"))}clearInputs(){for(let e of Object.values(this.inputs))e.value=""}show(e){this.shown=e,requestAnimationFrame(this._show)}_show(){l.toggleShown(this.shown==="inputs",[document.getElementById("game-inputs"),document.getElementById("item-submit-button")],[document.getElementById("game-evals"),document.getElementById("item-next-button")]),l.toggleShown(this.shown==="inputs",null,document.querySelector("#symbol-current .symbol-label"),"visibility"),this.shown==="inputs"?(document.querySelectorAll("#game-symbols .symbol-reference").forEach(e=>{e.remove()}),this.focus()):document.getElementById("item-next-button").focus()}updateProgressBar(e=null){e??=this.dealer.progress(),document.getElementById("progress-bar").style.setProperty("--progress",e)}newRound(){if(this.dealer.isEmpty()){this.finish();return}this.dealer.nextItem(),this.displayItem(this.currentItem()),this.clearInputs(),this.show("inputs")}focus(){this.inputs[this.properties[0]].focus({preventScroll:!0})}displayItem(e){this.updateItemNode(document.getElementById("symbol-current"),e)}clearItemDisplay(){document.querySelector("#symbol-current .symbol").textContent="",document.querySelector("#symbol-current .symbol-label").textContent=""}};var ds=v.range;var R={arabic:{name:"Arabic",file:"arabic.json"},elements:{name:"Atomic Elements",file:"elements.json"},cyrillic:{name:"Cyrillic",file:"cyrillic.json"},elder_futhark:{name:"Elder Futhark",file:"elder_futhark.json"},greek:{name:"Greek",file:"greek.json"},hebrew:{name:"Hebrew",file:"hebrew.json"},japanese:{name:"Japanese Kana",file:"japanese.json"},phoenician:{name:"Phoenician",file:"phoenician.json"},younger_futhark:{name:"Younger Futhark",file:"younger_futhark.json"}};function nt(s,e){let t=[],n=new Array(e).fill(!1);for(let[r,o]of s.entries()){if(o==="rest"){r!==s.length-1&&console.error("Can only have subset 'rest' at the end."),t.push(Q(n,c=>!c));break}let a=[];for(let c of un(o))if(a.push(c),c!==null){if(n[c])throw new Error(`Duplicate subset index ${c}.`);n[c]=!0}t.push(a)}let i=Q(s,r=>!r);if(i.length!==0)throw new Error(`Not all indices were covered: missing ${i}.`);return t}function un(s){if(typeof s=="string")return dn(s);if(typeof s=="number")return[s];if(!Array.isArray(s))throw new Error("Invalid indices datatype: need string, number or number[].");return hn(s)&&console.warn("Indices contain duplicates."),s}function hn(s){return new Set(s).size!==s.length}function dn(s){return[].concat(...s.split(",").map(pn))}function pn(s){let e=s.split(":").map(fn);if(e.length===1)return e;if(e.length===0||e.length>3)throw new Error("Invalid range, 2-3 numbers.");let t=e[0],n=e[e.length-1],i=e.length===3?e[1]:1;if(n<t||i<1)throw new Error("Invalid range, must have start <= stop and step >= 1.");return C(t,n+1,i)}function fn(s){let e=parseInt(s);if(isNaN(e))throw new Error("Not a number.");return e}function st(s,e){let t=new Array(e);for(let[n,i]of s.entries())for(let[r,o]of i.entries())t[o]=[n,r];return t}var K=class{constructor(){this.sizes=new WeakMap,this.updateSize=this.updateSize.bind(this),this.updateListeners=new g,this.observer=new ResizeObserver(e=>{e.forEach(this.updateSize),this.updateListeners.call(this,e.map(t=>t.target))})}watch(e){for(let t of e)this.observer.observe(t)}unwatch(e){for(let t of e)this.observer.unobserve(t),this.sizes.has(t)&&this.sizes.delete(t)}updateSize(e){this.sizes.set(e.target,e.contentBoxSize[0])}getSize(e){return this.sizes.get(e)}teardown(){this.observer.disconnect(),this.updateListeners.clear()}},$=class{constructor({watcher:e=null,uniformFactor:t=1/0,dimension:n="width"}={}){this.watcher=e??new K,this.updateParents=this.updateParents.bind(this),this.watcher.updateListeners.push(this.updateParents.bind(this)),this.dimension=n,this.uniformFactor=t,this.scales=new Map,this.minScale=1/0,this.maxScale=-1/0,this.childrenFromParent=new WeakMap}fit(e){this._add(e),this.updateChildren(e)}_add(e){for(let t of e){let n=t.parentElement;this.childrenFromParent.has(n)||this.childrenFromParent.set(n,new Set),this.childrenFromParent.get(n).add(t)}this.watcher.watch(e.map(t=>t.parentElement))}updateParents(e){this.updateChildren(e.map(t=>Array.from(this.childrenFromParent.get(t))).flat())}updateChildren(e=null){let t=this.minScale,n=this.maxScale;if(e)for(let i of e)this._updateScale(i);else this.scales.forEach((i,r)=>{this._updateScale(r)});!e||(this.minScale!==t||this.maxScale!==n)&&(this.uniformityActive()||this.uniformityActive(t,n))?this._applyAllScales():this._applyScales(e)}uniformityActive(e=this.minScale,t=this.maxScale){return t/e>this.uniformFactor}_updateScale(e){let t=this.watcher.getSize(e.parentElement);if(!t)return;let n=mn(e,t,this.dimension);n!==null&&(this.scales.set(e,n),n>0&&n<this.minScale?this.minScale=n:n>this.maxScale&&(this.maxScale=n))}_applyScale(e,t=null){t??=this.scales.get(e),e.style.scale=Math.min(t,this.minScale*this.uniformFactor)}_applyScales(e){for(let t of e)this._applyScale(t)}_applyAllScales(){for(let[e,t]of this.scales)this._applyScale(e,t)}teardown(){this.scales.clear(),this.watcher.updateListeners.remove(this.updateParents)}};function mn(s,e,t){if(!["width","height","both"].includes(t))throw new Error(`Invalid scale dimension ${t}.`);let n=1;if(t==="both"||t==="width"){let i=it(s.offsetWidth,e.inlineSize);if(i===null)return null;n=Math.min(n,i)}if(t==="both"||t==="height"){let i=it(s.offsetHeight,e.blockSize);if(i===null)return null;n=Math.min(n,i)}return n}function it(s,e,t=!1){if(s===0||isNaN(s)||isNaN(e))return null;let n=e/s;return t?n:Math.min(n,1)}var ke=v.range,rt={buttonMinWidth:"--button-min-width",buttonMaxWidth:"--button-max-width",symbolSize:"--symbol-size",labelGap:"--label-gap",symbolMinWidth:"--symbol-min-width"},_=class{constructor(e){if(!Array.isArray(e))throw new Error("Invalid argument: SelectorBlock.items must be an array.");this.items=e,this.updateListeners=new g,this._bindListeners(),this._setupButtons()}_bindListeners(){this._onButtonClick=this._onButtonClick.bind(this),this._onRangePointerDown=this._onRangePointerDown.bind(this),this._onRangePointerMove=this._onRangePointerMove.bind(this),this._onRangePointerUpCancel=this._onRangePointerUpCancel.bind(this)}_setupButtons(){this._buttonIdPrefix=l.uniqueIdPrefix("selectorButton"),this.checked=new Array(this.items.length).fill(!0),this.buttons=ke(this.items.length).map(e=>this._createButton(e,!0))}_createButton(e,t){let n=l.createElement("div.selector-button"),i=this._buttonIdPrefix+e.toString();return l.setAttrs(n,{id:i,role:"checkbox",tabindex:0,"aria-checked":t,"aria-labelledby":i}),n.dataset.index=e.toString(),n}_setupNode(){this.node=l.createElement("div.selector-block"),this.node.append(...this.buttons)}_setupButtonWatcher(){this.buttonWatcher=new K,this.buttonWatcher.watch(this.buttons)}_setupContentFitter(){this.buttonWatcher||this._setupButtonWatcher(),this.contentFitter=new $({watcher:this.buttonWatcher,uniformFactor:1.5,dimension:"width"}),this.contentFitter.fit(this.buttons.map(e=>e.querySelector(".selector-button-content")))}_setupLabelFitter(){this.labelFitter=new $({watcher:this.buttonWatcher,dimension:"width"}),this.labelFitter.fit(this.buttons.map(e=>e.querySelector(".selector-button-label")))}setupButtonContents(e){this.items.forEach((t,n)=>{let i=e(t,n);i.classList.add("selector-button-content"),this.buttons[n].prepend(i)})}labelButtons(e){for(let[t,n]of this.items.entries())this.labelButton(t,e(n,t));this.labelFitter||this._setupLabelFitter(),this.labelFitter.updateChildren()}labelButton(e,t){let n=this.buttons[e],i=n.querySelector(".selector-button-label");i||(i=l.createElement("span.selector-button-label"),n.append(i)),i.textContent=t}finishSetup(){this._setupNode(),this._setupListeners(),this._setupButtonWatcher(),this._setupContentFitter()}_callUpdateListeners(){this.updateListeners.call(this,this.checked)}updateButtonContents(e){for(let[t,n]of this.buttons.entries())e(n.querySelector(".selector-button-content"),this.items[t],t);this.contentFitter.updateChildren()}applyStyle(e){"buttonWidth"in e&&(e.buttonMinWidth=e.buttonWidth,e.buttonMaxWidth=e.buttonWidth,delete e.buttonWidth);for(let[t,n]of Object.entries(e))t in rt||console.error(`Invalid selector block style property ${t}.`),this.node.style.setProperty(rt[t],n)}_setARIAProperty(e,t){for(let[n,i]of this.buttons.entries())l.setARIA(i,e,t(this.items[n],n))}setChecked(e){this.items.forEach((t,n)=>this._setButtonChecked(n,e(t,n),{updateIfDisabled:!0,callUpdateListeners:!1}))}setDisabled(e){this._setARIAProperty("disabled",e)}getChecked(e=!1){return this.checked.map((t,n)=>t&&(e||!this.isDisabled(n)))}checkedCount(e=!1){return this.checked.reduce((t,n,i)=>n&&(e||!this.isDisabled(i))?t+1:t,0)}getCheckedItems(){return this.items.filter((e,t)=>this.checked[t])}getDisabled(){return this.buttons.map(e=>e.getAttribute("aria-disabled")==="true")}_setButtonChecked(e,t,{updateIfDisabled:n=!1,callUpdateListeners:i=!0}={}){!n&&this.isDisabled(e)||(l.setARIA(this.buttons[e],"checked",t),this.checked[e]=t,i&&this._callUpdateListeners())}isChecked(e,t=!1){return this.checked[e]&&(t||!this.isDisabled(e))}isDisabled(e){return l.getARIA(this.buttons[e],"disabled")==="true"}_toggleItems(e,{updateIfDisabled:t=!1,callUpdateListeners:n=!0}={}){let i=e.findIndex(r=>!this.isChecked(r))!==-1;for(let r of e)this._setButtonChecked(r,i,{updateIfDisabled:t,callUpdateListeners:!1});n&&this._callUpdateListeners()}_setupListeners(){this.node.addEventListener("click",this._onButtonClick),this.node.addEventListener("keypress",this._onButtonClick),this._resetRangeSelection(),this.node.addEventListener("pointerdown",this._onRangePointerDown)}_removeListeners(){this.node.removeEventListener("click",this._onButtonClick),this.node.removeEventListener("keypress",this._onButtonClick),this.node.removeEventListener("pointerdown",this._onRangePointerDown),this.node.removeEventListener("pointermove",this._onRangePointerMove)}_buttonFromTarget(e){return e.closest(".selector-button")}_rangeTargetIndex(e){let t=this._buttonFromTarget(e);return t?parseInt(t.dataset.index):null}_onButtonClick(e){if(e.type==="keypress"&&e.key!=="Enter")return;let t=e.target.closest(".selector-button, .selector-button-gap");if(t&&t.classList.contains("selector-button")){let i=t.dataset.index;this._setButtonChecked(i,!this.isChecked(i))}let n=this._rangeTargetIndex(e.target);n!==null&&(e.type==="click"&&e.detail%2===0&&this.lastClickTargetIndex===n&&this._toggleItems(ke(this.buttons.length),{updateIfDisabled:!0}),this.lastClickTargetIndex=n)}_resetRangeSelection(){this._removeRangeListeners(),this.rangeIndices&&this._buttonsRemoveClass(this.rangeIndices,"active"),this.rangeIndices=null,this.rangeStartIndex=null,this.rangeStopIndex=null,this.isRangeSelecting=!1}_onRangePointerMove(e){if(!this.isRangeSelecting)return;let t=document.elementFromPoint(e.clientX,e.clientY),n=this._rangeTargetIndex(t);n===null||this.rangeStopIndex===n||(this.rangeStartIndex??=n,this.rangeStopIndex=n,this._updateRangeSelection())}_onRangePointerDown(e){let t=this._rangeTargetIndex(e.target);t!==null&&(this.rangeStartIndex=t,this.rangeStopIndex=t,this._updateRangeSelection()),this.isRangeSelecting=!0,this._addRangeListeners()}_onRangePointerUpCancel(e){this.isRangeSelecting&&(e.type==="pointerup"&&this.rangeIndices&&this.rangeStartIndex!==this.rangeStopIndex&&this._toggleItems(this.rangeIndices),this._resetRangeSelection())}_updateRangeSelection(){this.rangeIndices&&this._buttonsRemoveClass(this.rangeIndices,"active"),this.rangeStartIndex!==null&&this.rangeStopIndex!==null?(this.rangeIndices=this._getRangeIndices(this.rangeStartIndex,this.rangeStopIndex),this._buttonsAddClass(this.rangeIndices,"active")):this.rangeIndices=null}_getRangeIndices(e,t){return t<e&&([e,t]=[t,e]),ke(e,t+1)}_addRangeListeners(){this.node.addEventListener("pointermove",this._onRangePointerMove),document.addEventListener("pointerup",this._onRangePointerUpCancel),document.addEventListener("pointercancel",this._onRangePointerUpCancel)}_removeRangeListeners(){this.node.removeEventListener("pointermove",this._onRangePointerMove),document.removeEventListener("pointerup",this._onRangePointerUpCancel),document.removeEventListener("pointercancel",this._onRangePointerUpCancel)}_buttonsRemoveClass(e,t){l.removeClass(this._buttonsFromIndices(e),t)}_buttonsAddClass(e,t){l.addClass(this._buttonsFromIndices(e),t)}_buttonsFromIndices(e){return e.map(t=>this.buttons[t])}teardown(){this._removeListeners(),this.buttonWatcher.teardown(),this.contentFitter.teardown(),this.labelFitter&&this.labelFitter.teardown()}};var T=class{constructor(e,t,n=null){this.items=e,this.subsets=nt(t,e.length),this.subsetsInverse=st(this.subsets,e.length),this.blocks=this.subsets.map((i,r)=>{let o=i.map(a=>this.items[a]);return n?n(o,r):new _(o)}),this.updateListeners=new g,this._callUpdateListeners=this._callUpdateListeners.bind(this),this.blocks.forEach(i=>i.updateListeners.push(this._callUpdateListeners))}_callUpdateListeners(){this.updateListeners.call(this,this.getChecked())}_buttonCallback(e,t){this.blocks.forEach((n,i)=>{e(n,(r,o,a)=>t(r,o,this.subsets[i][a]))})}_itemCallback(e,t){this.blocks.forEach((n,i)=>{e(n,(r,o)=>t(r,this.subsets[i][o]))})}setupButtonContents(e){this._itemCallback((t,n)=>t.setupButtonContents(n),e)}_setupNode(){this.node=l.createElement("div.selector"),this.node.append(...this.blocks.map(e=>e.node))}finishSetup(){this.blocks.forEach(e=>e.finishSetup()),this._setupNode()}updateButtonContents(e){this._buttonCallback((t,n)=>t.updateButtonContents(n),e)}labelButtons(e){this._itemCallback((t,n)=>t.labelButtons(n),e)}setChecked(e){this._itemCallback((t,n)=>t.setChecked(n),e)}setDisabled(e){this._itemCallback((t,n)=>t.setDisabled(n),e)}getCheckedItems(){let e=this.getChecked();return this.items.filter((t,n)=>e[n])}getChecked(e=!1){let t=this.blocks.map(n=>n.getChecked(e));return C(this.items.length).map(n=>{let[i,r]=this.subsetsInverse[n];return t[i][r]})}checkedCount(e=!1){return J(this.blocks.map(t=>t.checkedCount(e)))}getDisabled(){let e=this.blocks.map(t=>t.getDisabled());return C(this.items.length).map(t=>{let[n,i]=this.subsetsInverse[t];return e[n][i]})}isChecked(e){let[t,n]=this.subsetsInverse[e];return this.blocks[t].isChecked(n)}isDisabled(e){let[t,n]=this.subsetsInverse[e];return this.blocks[t].isDisabled(n)}applyStyle(e){this.blocks.forEach(t=>t.applyStyle(e))}teardown(){this.blocks.forEach(e=>e.teardown())}};l.registerTemplate("headingElement",'<div class="heading-element"><span class="heading-element-number"></span><span class="heading-element-symbol"></span></div>');var gn="./json/datasets/",ot="greek",bn={gameHeading:"Kadmos",terms:{letter:"letter"},lang:"en",dir:"ltr"},at=["letter","letters"],yn={data:{default:"Default"},exclusive:!1},Sn={keys:["en"]},vn={en:"English",de:"German"},z=class{static _cache={};constructor(e){this.name=e.name,this.metadata=this.processMetadata(e.metadata),this.processFonts(e.fonts),this.gameConfig=e.game??{},this.forms=this.processForms(e.forms),this.properties=e.properties,this.selectorData=this.processSelectorData(e.selector),this.variants=this.processVariants(e.variants),this.languages=e.languages??Sn,this.languages.default??=this.languages.keys[0],this.items=this.processItems(e.items)}static fetch(e){return e in R?e in this._cache?Promise.resolve(this._cache[e]):fetch(gn+R[e].file).then(t=>t.json()).then(t=>{let n=new this(t);return n.key=e,this._cache[e]=n,n}).catch(t=>console.error(t)):(console.error(`Invalid dataset key "${e}".`),null)}processSelectorData(e){return e??={},e.blocks??=e.block?[e.block]:[{mode:"flex"}],e}processMetadata(e){return e=Object.assign({},bn,e),e.terms.letter??="letter",e.terms.letters??=e.terms.letter+"s",e}processForms(e){e??=yn;for(let[t,n]of Object.entries(e.data))typeof n=="string"&&(e.data[t]={label:n});return e}processVariants(e){if(!e||!e.data)return null;for(let[t,n]of Object.entries(e.data))typeof n=="string"&&(e.data[t]={label:n}),e.data[t].lang??=t;return e}getGameSettings(e){let t={};return this.hasSetting("properties")&&(t.properties=this.propertySetting(e.properties)),this.hasSetting("language")&&(t.language=this.languageSetting(e.language)),b.createFrom(t)}getFilterSettings(e){let t={};return this.hasVariants()&&(t.variant=this.variantSetting(e.variant)),this.hasSetting("forms")&&(t.forms=this.formsSetting(e.forms)),b.createFrom(t)}propertySetting(e=null){return x.from(u.map(this.properties,t=>t.label),{label:"Properties",checked:e??u.map(this.properties,t=>!!t.active)})}languageSetting(e=null){return x.from(u.onlyKeys(vn,this.languages.keys),{label:"Language",checked:e??this.languages.default,exclusive:!0})}ungroupedForms(){return u.filter(this.forms.data,e=>!("groupWith"in e))}formsSetting(e=null){if(!this.hasSetting("forms"))return null;let t=this.forms.label??(this.forms.exclusive?"Form":"Forms"),n=this.ungroupedForms();return x.from(u.map(n,i=>i.label),{label:t,exclusive:this.forms.exclusive,checked:e??u.map(n,i=>i.active??!this.forms.exclusive)})}variantSetting(e=null){return B.createSelect(u.map(this.variants.data,t=>t.label),{label:"Variant",selected:e??this.variants.default??Object.keys(this.variants.data)[0],groups:this.variants.groups?Object.values(this.variants.groups):[]})}hasSetting(e){switch(e){case"properties":return Object.keys(this.properties).length>1;case"language":return this.languages.keys.length>1;case"variant":return this.hasVariants();case"forms":return Object.keys(this.ungroupedForms()).length>1;case"font-family":return Object.keys(this.fonts).length>1;default:throw new Error(`Invalid settings key ${e}.`)}}hasVariants(){return!!this.variants}getLang(e=null){return e?this.variants.data[e].lang??e:this.metadata.lang}getDir(){return this.metadata.dir}getSelector(e=null){let t=new T(this.items,this.selectorData.blocks.map(o=>o.indices??"rest")),n=this.getLang(e),i=this.getDir(),r=this.getSelectorDisplayFont();return t.setupButtonContents(o=>{let a=l.createElement("span.symbol-string");return a.append(...Object.values(o.getFormNodes())),w.setFont(a,r),n&&(a.lang=n),i&&(a.dir=i),a}),this.selectorData.label&&t.labelButtons(o=>o.getSelectorLabel(this.selectorData.label)),t.finishSetup(),t.node.dir=i,this.selectorData.style&&t.applyStyle(this.selectorData.style),this.selectorData.blocks.forEach((o,a)=>{o.style&&t.blocks[a].applyStyle(o.style)}),t}applySettings(e,t){let n=this.getFormsFromSettingsValue(t.forms);e.updateButtonContents(r=>{r.querySelectorAll(".symbol-form").forEach(o=>{let a=n.includes(o.dataset.form);l.toggleShown(a,o)})});let i=this.getVariantItemIndices(t.variant);e.setDisabled((r,o)=>!i.has(o)||r.getForms(n).length===0)}getVariantItemIndices(e){if(!e)return new Set(C(this.items.length));let t=new Set;return this.items.forEach((n,i)=>{n.variants.has(e)&&t.add(i)}),t}getFormsFromSettingsValue(e){if(!e)return Object.keys(this.forms.data);let t=e.slice();for(let[n,i]of Object.entries(this.forms.data))if("groupWith"in i&&e.includes(i.groupWith)){let r=t.indexOf(i.groupWith);r!==-1&&t.splice(r+1,0,n)}return t}getVariantFontModification(e,t){if(t){let n=this.variants.data[t].fonts;if(n&&e in n)return n[e]}return null}getFont(e,t=null){return e?(typeof e=="string"&&(e={key:e}),"family"in e&&console.warn(`Found family property "${e.family}" in font: Will be overwritten!`),e.key??=this._defaultFontKey,e.key in this.fonts||(console.error(`Unknown font key "${e.key}".`),e.key=this._defaultFontKey),u.withoutKeys(Object.assign({},this.fonts[e.key],this.getVariantFontModification(e.key,t),e),["key","default","label"])):this.defaultFont()}getSelectorDisplayFont(e){return this.getFont(this.selectorData.font,e)}processFonts(e){this.fonts=e;let t=Object.entries(e).find(([n,i])=>i.default);this._defaultFontKey=t?t[0]:Object.keys(e)[0]}defaultFont(){return this.fonts[this._defaultFontKey]}fontFamilySetting(e=null){let t=x.from(u.map(this.fonts,n=>n.label??n.family),{label:"Font",exclusive:!0,checked:e??this._defaultFontKey});return t.node.classList.add("font-family-setting"),t}processItems({properties:e,data:t,symbolType:n="string"}){let i=new Array(t.length);for(let[r,o]of t.entries()){let a=this.processDisplayForms(o[0]),c;this.hasVariants()&&(c=this.processItemVariants(o[1]));let h=u.fromKeysValues(e,o.splice(this.hasVariants()?2:1),!1);i[r]=new Le(n,a,h,c)}return i}processItemVariants(e){if(!e||e==="*")return Object.keys(this.variants.data);if(Array.isArray(e))return e;let t=e.substring(0,2)!=="*-";t||(e=e.substring(2));let n=u.map(this.variants.data,()=>!t);for(let i of e.split(","))if(i in this.variants.data)n[i]=t;else if(this.variants.groups&&i in this.variants.groups)for(let r of this.variants.groups[i])n[r]=t;return u.filterKeys(n,i=>i)}processDisplayForms(e){if(Object.keys(this.forms.data).length===1)return Array.isArray(e)&&(e=e[0]),Object.fromEntries([[Object.keys(this.forms.data)[0],e]]);if(typeof e=="string"&&(e=e.split("")),Array.isArray(e)){let t={},n=Object.keys(this.forms.data);for(let[i,r]of e.entries())r&&(t[n[i]]=r);return t}if(typeof e!="object")throw new Error("Invalid display format: need array or object.");return u.onlyKeys(e,Object.keys(this.forms.data),!0)}getQuizItems(e,t,n,i=null){let r=[];for(let o of e){let a=o.getDisplayStrings(t),c=o.getItemProperties(n,this.properties,i);r.push(...Object.entries(a).map(([h,d])=>new O(o.type,d,c,h)))}return r}referencePropsData(){let e=Object.assign({},this.properties);for(let[t,n]of Object.entries(e))if("referenceMaxDist"in n){let i=Object.assign({},n);i.maxDist=n.referenceMaxDist,e[t]=i}return e}getReferenceItems(e,t=null){let n,i=this.referencePropsData();if(this.forms.exclusive){let r=this.items.map(o=>o.getItemProperties(e,i,t));return u.map(this.forms.data,(o,a)=>this.items.map((c,h)=>new O(c.type,c.getFormsDisplayString([a]),r[h],a)))}else return n=this.items.map(r=>new O(r.type,r.getFormsDisplayString(Object.keys(this.forms.data)),r.getItemProperties(e,i,t),"all")),u.map(this.forms.data,()=>n)}setupGameHeading(e){let t=this.metadata.gameHeading;if(w.setFont(e,this.getFont(t.font)),this.name==="Atomic Elements"){let n=document.createElement("div");n.classList.add("element-heading-container");let i=[];for(let[r,o]of[[19,"K"],[85,"At"],[42,"Mo"],[16,"S"]]){let a=l.getTemplate("headingElement");a.querySelector(".heading-element-symbol").textContent=o,a.querySelector(".heading-element-number").textContent=r,i.push(a)}n.replaceChildren(...i),e.replaceChildren(n)}else e.replaceChildren(t.string);e.setAttribute("lang",t.lang??this.metadata.lang),e.setAttribute("dir",t.dir??this.metadata.dir)}},Le=class{constructor(e,t,n,i=null){this.type=e,this.displayForms=t,this.properties=n,this.variants=new Set(i)}getDisplayStrings(e){return u.onlyKeys(this.displayForms,e)}getItemProperties(e,t,n=null){let i={};for(let r of e){if(!(r in this.properties)){console.error(`Missing property key "${r}".`);continue}i[r]=this.properties[r]}if(n)for(let r of e){let o=r+"_"+n;this.properties[o]&&(i[r]=this.properties[o])}return u.map(i,(r,o)=>k.fromData(r,t[o]))}getFormNode(e){let t=l.createElement("span.symbol-form");return t.dataset.form=e,t.textContent=this.displayForms[e],t}getForms(e=null){return e?e.filter(t=>t in this.displayForms):Object.keys(this.displayForms)}getFormNodes(e=null){return u.mapKeyArrayToValues(this.getForms(e),t=>this.getFormNode(t))}getFormsDisplayString(e){return Object.values(this.getDisplayStrings(e)).join("")}countQuizItems(e){return e.reduce((t,n)=>n in this.displayForms?t+1:t,0)}getSelectorLabel({property:e=null,splitFirst:t=!0,splitter:n="[,;/]"}={}){let i=this.properties[e];return t?i.split(new RegExp(`s*(${n})s*`))[0]:i}};var y=null,p=null,L=new b,N=new b,Ae=new b,S=null,lt=null;function dt(){wn(),En(),Ae.replaceSelf(G.genericSettings()),document.getElementById("generic-game-settings").append(...Ae.nodeList()),window.addEventListener("popstate",()=>l.transition(ht)),In(),ht(!1)}function wn(){document.getElementById("start-game-button").addEventListener("click",()=>l.transition(ft)),document.getElementById("stop-game-button").addEventListener("click",()=>{y.finish()}),document.getElementById("item-submit-button").addEventListener("click",()=>{l.transition(()=>{y.submitRound()},["game"])}),document.getElementById("item-next-button").addEventListener("click",()=>{l.transition(()=>{y.newRound()},["game"])})}function In(){let s=document.getElementById("datasetSelect");l.setOptions(s,u.map(R,e=>e.name)),s.addEventListener("change",e=>{let t=e.target.value;z.fetch(t).then(n=>l.transition(()=>pt(n))).catch(console.error)})}function Be(s){s||l.showPage(document.getElementById("game-filters")),l.toggleShown(s,[document.getElementById("game-container"),document.getElementById("stop-game-button"),document.getElementById("progress-bar")],[document.getElementById("new-game-settings")])}function En(){lt=b.createFrom({accentColor:Ln(),colorMode:Cn()}),document.querySelector("#page-settings .settings").replaceChildren(...lt.nodeList()),document.getElementById("open-settings-button").addEventListener("click",()=>{l.transition(xn,["page-settings","ease-in"])}),document.getElementById("close-settings-button").addEventListener("click",()=>{l.transition(kn,["page-settings","ease-out"])})}function xn(){l.show(document.getElementById("page-settings-container")),document.documentElement.style.overflowY="hidden"}function kn(){l.hide(document.getElementById("page-settings-container")),document.documentElement.style.removeProperty("overflow-y")}function Ln(){let s=window.localStorage.getItem("accentHue")||250;ct(s);let e=P.create(0,360,s);return e.label("Accent Hue"),e.updateListeners.push(t=>ct(t)),e.node.id="accentHueSlider",e}function ct(s){document.documentElement.style.setProperty("--accent-hue",s),window.localStorage.setItem("accentHue",s)}function Cn(){let s=window.matchMedia("(prefers-color-scheme: dark)"),e=window.localStorage.getItem("colorMode")||(s.matches?"dark":"light");Ce(e);let t=x.from({dark:"Dark Mode",light:"Light Mode"},{label:"Color Mode",exclusive:!0,checked:e});return s.addEventListener("change",n=>{let i=n.matches?"dark":"light";t.value=[i],Ce(i)}),t.updateListeners.push(n=>l.transition(()=>Ce(n,{updateLocalStorage:!0}))),t}function Ce(s,{updateLocalStorage:e=!1}={}){if(s!=="dark"&&s!=="light")throw new Error(`Invalid color mode ${s}, use dark or light.`);l.classIfElse(s==="dark",document.documentElement,"dark-mode","light-mode"),e&&window.localStorage.setItem("colorMode",s)}function pt(s){p=s,l.setSearchParams({dataset:s.key}),An();let e=Rn(),t=p.metadata.gameHeading;return ve([p.getFont(t.font),p.getSelectorDisplayFont()]).then(()=>{Bn(),l.showPage(document.getElementById("game-filters")),p.setupGameHeading(document.querySelector("#game-heading h1")),Fn(e),_n(e)})}function An(){document.title=p?`${p.name} - Kadmos`:"Kadmos"}function Bn(){for(let s of at){let e=p.metadata.terms[s];document.querySelectorAll(".term-"+s).forEach(t=>{t.textContent=e})}}function _n(s={}){S&&(S.teardown(),S.node.remove()),S=p.getSelector(),document.getElementById("dataset-filter-settings").append(S.node),s.checked&&S.setChecked((e,t)=>s.checked[t]),p.applySettings(S,L.getValues()),S.updateListeners.push(ut,oe),ut()}function Fn(s){L.replaceSelf(p.getFilterSettings(s)),N.replaceSelf(p.getGameSettings(s)),L.addUpdateListener(oe),N.addUpdateListener(oe),L.addUpdateListener(()=>l.transition(()=>{p.applySettings(S,L.getValues())})),document.getElementById("dataset-filter-settings").replaceChildren(...L.nodeList()),document.getElementById("dataset-game-settings").replaceChildren(...N.nodeList())}function Pn(){return p.hasSetting("forms")?p.getFormsFromSettingsValue(L.getValue("forms")):Object.keys(p.forms.data)}function On(){return N.getDefault("properties",Object.keys(p.properties))}function ut(){document.querySelector("#game-settings-pages .pages-next-button").disabled=S.checkedCount()===0}function ft(){y&&y.cleanup(),oe();let s=On(),e=N.getDefault("language",null),t=p.getQuizItems(S.getCheckedItems(),Pn(),s,e),n=p.getReferenceItems(s,e),i=p.hasVariants()?L.getValue("variant"):null;y=new G(p,t,s,e,i);let r=Ae.getValue("seed");r&&y.seed(r),y.setReferenceItems(n),y.onFinish.push(()=>{Be(!1)}),y.setup({defaultWeight:p.gameConfig.defaultWeight}).then(()=>{Be(!0),y.newRound(),y.focus()}).catch(o=>console.error(o))}function ht(){let s=new URLSearchParams(location.search),e=s.get("dataset");(!e||!(e in R))&&(e=ot),document.getElementById("datasetSelect").value=e,z.fetch(e).then(t=>pt(t)).then(()=>{["1","true"].includes(s.get("play"))?ft():Be(!1)})}function mt(s=null){return"settings_"+(s||p.key)}function oe(){l.setSearchParams({dataset:p.key});let s=Object.assign({checked:q.encodeBase64BoolArray(S.getChecked())},L.getValues(),N.getValues());window.localStorage.setItem(mt(),JSON.stringify(s))}function Rn(){let s=window.localStorage.getItem(mt());if(!s)return{};try{let e=JSON.parse(s);return typeof e.checked=="string"&&(e.checked=q.decodeBase64BoolArray(e.checked)),e}catch(e){return console.error(e),{}}}(function(){Tn(),l.transition(dt),document.querySelectorAll(".ribbon").forEach(s=>{Nn(s,s.classList.contains("ribbon-closable"))}),document.querySelectorAll(".pages-container").forEach(s=>{l.setupPages(s)})})();function Tn(){let s=new URLSearchParams(location.search);["1","true"].includes(s.get("darkmode"))?document.documentElement.classList.add("dark-mode"):["1","true"].includes(s.get("lightmode"))&&document.documentElement.classList.add("light-mode")}function Nn(s,e=!1){let t=s.querySelector(".ribbon-contents"),n=s.querySelectorAll(".ribbon-buttons input[type=checkbox]");s.dataset.closable=e.toString();let i=s.dataset.openId;if(!i){for(let r of n)if(r.checked){i=r.dataset.contentId;break}}l.hide(t.querySelectorAll(".ribbon-content")),!i&&!e&&(i=n[0].dataset.contentId,n[0].checked=!0),i?l.show([document.getElementById(i),t]):e&&s.classList.add("contents-hidden"),s.querySelector(".ribbon-buttons").addEventListener("change",Mn)}function Mn(s){l.transition(()=>{let e=s.target,t=e.closest(".ribbon"),n=t.querySelector(".ribbon-contents");if(e.checked){let i=t.dataset.openId;!t.classList.contains("contents-hidden")&&i&&(l.hide(document.getElementById(i)),t.querySelector(`.ribbon-buttons input[data-content-id="${i}"]`).checked=!1),t.dataset.openId=e.dataset.contentId,l.show([document.getElementById(e.dataset.contentId),n]),t.classList.remove("contents-hidden")}else t.dataset.closable==="true"?(t.classList.add("contents-hidden"),l.hide(n),t.dataset.openId=""):e.checked=!0},{transition:!0})}})();
//# sourceMappingURL=index.js.map
