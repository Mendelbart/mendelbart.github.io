(()=>{var be=Object.defineProperty;var M=(n,t)=>{for(var e in t)be(n,e,{get:t[e],enumerable:!0})};var u={};M(u,{extractKeys:()=>we,filter:()=>Se,filterKeys:()=>ve,fromKeysValues:()=>Ie,map:()=>ut,mapKeyArrayToValues:()=>Ee,mapKeys:()=>xe,onlyKeys:()=>ht,subsetToBoolRecord:()=>ke,withoutKeys:()=>X});var E={};M(E,{arraysEqual:()=>ct,avg:()=>ye,bisectLeft:()=>lt,cumSums:()=>at,filterIndices:()=>Q,full:()=>Pt,range:()=>A,sum:()=>J});function at(n){return n.map((t=>e=>t+=e)(0))}function lt(n,t){let e=0,s=t.length,i;for(;e<s;)i=e+s>>1,t[i]<n?e=i+1:s=i;return e}function J(n){return n.reduce((t,e)=>t+e,0)}function ye(n){return n.length===0?(console.error("Cannot compute average of empty array."),0):J(n)/n.length}function ct(n,t){return n.length===t.length&&n.every((e,s)=>e===t[s])}function Q(n,t){return Array.from(n.entries()).filter(([e,s])=>t(s,e,n)).map(([e,s])=>e)}function A(n,t=null,e=1){t===null&&(t=n,n=0);let s=Math.ceil((t-n)/e);return Pt(s,i=>n+e*i)}function Pt(n,t){let e=new Array(n);for(let s=0;s<n;s++)e[s]=t(s);return e}function ut(n,t){return Object.fromEntries(Object.entries(n).map(([e,s],i)=>[e,t(s,e,i)]))}function Se(n,t){return Object.fromEntries(Object.entries(n).filter(([e,s],i)=>t(s,e,i)))}function ve(n,t){return Object.entries(n).filter(([e,s],i)=>t(s,e,i)).map(([e,s])=>e)}function X(n,t){typeof t=="string"&&(t=[t]);let e=Object.assign({},n);for(let s of t)delete e[s];return e}function we(n,t,e=!0){let s=t.map(i=>n[i]??null);return e&&s.push(X(n,t)),s}function ht(n,t,e=!1){let s=new Set(t),i={};for(let[r,o]of Object.entries(n))s.has(r)?i[r]=o:e&&console.warn(`Filtered out key "${r}".`);return i}function xe(n,t){return Object.fromEntries(Object.entries(n).map(([e,s])=>[t(e),s]))}function Ee(n,t){return Object.fromEntries(n.map(e=>[e,t(e)]))}function Ie(n,t,e=!0){return e&&n.length>t.length&&console.warn("More keys than values."),Object.fromEntries(t.map((s,i)=>[n[i],s]))}function ke(n,t){if(n==="none")n=[];else if(n==="all")n=t;else if(typeof n=="string")throw new Error('Invalid subset string specifier - use "none" or "all".');if(Array.isArray(n)){let e=Object.fromEntries(t.map(s=>[s,!1]));for(let s of n)e[s]=!0;return e}return ct(Object.keys(n).sort(),t.sort())||(console.log(n,t),console.warn("Subset object keys don't match keys list."),console.log(Object.keys(n).sort(),t.sort())),Object.fromEntries(t.map(e=>[e,!!n[e]]))}var l={};M(l,{addClass:()=>Ut,appendChildren:()=>Oe,button:()=>_e,classIfElse:()=>R,classesToList:()=>pt,computeScaleToFit:()=>bt,createElement:()=>Fe,elementSize:()=>mt,forEachElement:()=>et,getARIA:()=>Ve,getTemplate:()=>dt,hide:()=>B,htmlToElement:()=>Ce,htmlToElements:()=>Rt,label:()=>Ae,registerTemplate:()=>Bt,registerTemplates:()=>Dt,removeClass:()=>Pe,scaleAllToFit:()=>Me,scaleToFit:()=>je,setARIA:()=>He,setAttrOnKeys:()=>Te,setAttrs:()=>Ht,setDefaultId:()=>qt,setOptions:()=>Le,setSearchParams:()=>Re,setupPages:()=>Be,show:()=>D,showPage:()=>Z,toggleShown:()=>ft,transition:()=>gt,uniqueIdPrefix:()=>Vt});var Nt=0;window.hasTouch="ontouchstart"in window;var tt={};function Dt(n){for(let[t,e]of Object.entries(n))Bt(t,e)}function Bt(n,t){n in tt&&console.warn(`Overwriting existing template key ${n}.`);let e=document.createElement("TEMPLATE");typeof t=="string"?e.insertAdjacentHTML("beforeend",t):e.append(t),tt[n]=e}function dt(n){return n in tt||console.error("Unknown template key "+n),tt[n].firstChild.cloneNode(!0)}Dt({buttonLabel:'<label class="button"></label>',buttonInput:'<input class="button-check form-input" autocomplete="off">'});function _e(n,t,e=null,s=null){let i=dt("buttonInput"),r=dt("buttonLabel");return s??=Vt("button")+t,Ht(i,{type:n,value:t,id:s}),r.setAttribute("for",s),e&&(typeof e=="string"&&(e=document.createTextNode(e)),r.appendChild(e)),[i,r]}function Ae(n,t,e=null){let s=document.createElement("LABEL");return n instanceof Node&&(n=qt(n,e)),s.setAttribute("for",n),s.textContent=t,s}function Rt(n){let t=document.createElement("TEMPLATE");return t.innerHTML=n,t.content.children}function Ce(n){let t=Rt(n);if(t.length!==1)throw new Error("HTML doesn't contain exactly one element.");return t[0]}function Fe(n){let[t,...e]=n.split("."),[s,i]=t.split("#"),r=document.createElement(s);return i&&(r.id=i),r.classList.add(...e),r}function Le(n,t,{selected:e=null,disabled:s=[],groups:i=[]}={}){e??=Object.keys(t)[0];let r=ut(t,()=>!1),o=null;for(let{label:a,keys:c}of i){let h=document.createElement("OPTGROUP");h.label=a;for(let d of c){if(!(d in t)){console.warn(`Unknown grouped key ${d} in group ${a}.`);continue}h.append(jt(d,t[d],e,s)),r[d]=!0}n.add(h),o||(o=h)}for(let[a,c]of Object.entries(t))r[a]||n.add(jt(a,c,e,s),o)}function jt(n,t,e,s){let i=document.createElement("OPTION");return i.value=n,i.textContent=t,e===n&&(i.selected="selected"),s.includes(n)&&(i.disabled="disabled"),i}function Oe(n,t){for(let e of t)n.appendChild(e)}function Te(n,t,e,s=""){if(t){typeof t=="string"&&(t=[t]);for(let i of t)n[i].setAttribute(e,s)}}function Ht(n,t){for(let[e,s]of Object.entries(t))typeof s=="boolean"?s?n.setAttribute(e,e):n.removeAttribute(e):e==="class"?Ut(n,s):n.setAttribute(e,s)}function Vt(n,t="_"){return Nt+=1,n+Nt+t}function qt(n,t){return n.hasAttribute("id")?(n.id=t,t):n.id}function et(n,t){if(n)if(n instanceof Node)t(n);else for(let e of n)t(e)}function R(n,t,e,s=null){n||([e,s]=[s,e]),e=pt(e),s=pt(s),et(t,i=>{i.classList.remove(...s),i.classList.add(...e)})}function Ut(n,t){R(!0,n,t)}function Pe(n,t){R(!1,n,t)}function D(n,t="display"){et(n,e=>{e.style.removeProperty(t)})}var Ne={display:"none",visibility:"hidden",opacity:"0"};function B(n,t="display"){et(n,e=>{e.style.setProperty(t,Ne[t])})}function ft(n,t,e=null,s="display"){n?(e&&B(e,s),D(t,s)):(B(t,s),e&&D(e,s))}function pt(n){return n??=[],typeof n=="string"?n.split(" "):Array.from(n)}function mt(n,t="border-box",e=!1){let s=e?n.scrollWidth:n.clientWidth,i=e?n.scrollHeight:n.clientHeight,r=window.getComputedStyle(n),o=r.scale;return!o||o==="none"?o=1:o=parseFloat(o),t==="border-box"?(s+=o*(parseFloat(r.borderLeftWidth||0)+parseFloat(r.borderRightWidth||0)),i+=o*(parseFloat(r.borderTopWidth||0)+parseFloat(r.borderBottomWidth||0))):t==="content-box"?(s-=o*(parseFloat(r.paddingLeft||0)+parseFloat(r.paddingRight||0)),i-=o*(parseFloat(r.paddingTop||0)+parseFloat(r.paddingBottom||0))):t!=="padding-box"&&console.error("Invalid value for element size box, use padding-box, content-box or border-box."),[s,i]}function bt(n,{container:t=null,dimension:e="width",elementBox:s="border-box",containerBox:i="content-box",grow:r=!1}={}){t??=n.parentElement;let[o,a]=mt(n,s,!0),[c,h]=mt(t,i),d=Mt(o,c,r),m=Mt(a,h,r);return["width","height","both"].includes(e)||(console.error("Invalid dimension, use 'width', 'height' or 'both'."),e="width"),e==="width"?d:e==="height"?m:Math.min(d,m)}function je(n,t={}){n.style.scale=bt(n,t)}function Me(n,t={}){if(Array.isArray(n)||(n=Array.from(n)),n.length===0)return;let e=n.map(s=>bt(s,t));e=De(e,t.maxScaleRatio??1/0);for(let[s,i]of n.entries())i.style.scale=e[s]}function De(n,t=1/0){if(t===1/0)return n;let e=Math.min(...n),s=Math.max(...n);if(e===0||s/e<=t)return n;let i=Math.log(t)/Math.log(s/e);return n.map(r=>(r/e)**i*e)}function Mt(n,t,e=!1){if(n===0)return console.warn("getScale: Element's size is 0."),1;if(isNaN(n))return console.error("Element size is NaN."),1;if(isNaN(t))return console.error("Container size is NaN."),1;let s=t/n;return e?s:Math.min(s,1)}function Be(n){Z(n.querySelector(".page-content"),n),n.querySelector(".pages-next-button").addEventListener("click",()=>gt(()=>Z(document.getElementById(n.dataset.openPage).nextElementSibling,n))),n.querySelector(".pages-back-button").addEventListener("click",()=>gt(()=>Z(document.getElementById(n.dataset.openPage).previousElementSibling,n)))}function Z(n,t=null){t??=n.closest(".pages-container"),B(t.querySelectorAll(".page-content")),B(t.querySelectorAll(".page-heading")),D(n),D(t.querySelector(`.page-heading[data-for="${n.id}"]`)),t.dataset.openPage=n.id,ft(!!n.previousElementSibling,t.querySelector(".pages-back-button")),ft(!!n.nextElementSibling,t.querySelector(".pages-next-button"),t.querySelector(".pages-finish-button")),n.nextElementSibling||t.querySelector(".pages-finish-button").focus()}function Re(n){let t=new URL(location),e=!1;for(let[s,i]of Object.entries(n)){let r=encodeURIComponent(i);t.searchParams.get(s)!==r&&(t.searchParams.set(s,r),e=!0)}e&&history.pushState({},"",t)}function gt(n,t=[]){document.startViewTransition?document.startViewTransition({update:()=>n(),types:t}):requestAnimationFrame(()=>n())}function He(n,t,e){n.setAttribute("aria-"+t,e)}function Ve(n,t){return n.getAttribute("aria-"+t)}function qe(n){let t=1779033703,e=3144134277,s=1013904242,i=2773480762;for(let r=0;r<n.length;r++){let o=n.charCodeAt(r);t=e^Math.imul(t^o,597399067),e=s^Math.imul(e^o,2869860233),s=i^Math.imul(s^o,951274213),i=t^Math.imul(i^o,2716044179)}return t=Math.imul(s^t>>>18,597399067),e=Math.imul(i^e>>>22,2869860233),s=Math.imul(t^s>>>17,951274213),i=Math.imul(e^i>>>19,2716044179),t^=e^s^i,e^=t,s^=t,i^=t,[t>>>0,e>>>0,s>>>0,i>>>0]}function Ue(n,t,e,s){return function(){n|=0,t|=0,e|=0,s|=0;let i=(n+t|0)+s|0;return s=s+1|0,n=t^t>>>9,t=e+(e<<3)|0,e=e<<21|e>>>11,e=e+i|0,(i>>>0)/4294967296}}function We(n){return Ue(...qe(n))}var H=class{constructor(n=Math.random){this._rand=n}rand(n=null,t=null){return t===null?this._rand()*(n??1):(n??=0,this._rand()*(t-n)+n)}seed(n){this._rand=We(n)}randInt(n,t){return Math.floor(this.rand(n,t))}shuffle(n){for(let t=n.length;t>0;t--){let e=this.randInt(t);e!==t-1&&([n[t-1],n[e]]=[n[e],n[t-1]])}}randIndexFromWeights(n){let t=at(n);return lt(this.rand(t[t.length-1]),t)}};var v={};M(v,{clearFont:()=>Yt,getFontData:()=>Qe,loadFont:()=>St,loadFonts:()=>vt,setFont:()=>zt,setFontProperties:()=>xt,supportsStylesets:()=>wt,supportsVariableFonts:()=>Gt});var Wt=[{family:"Noto Serif Hebrew",scale:1.25,shift:-.05,fallback:"serif",variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Sans Hebrew",scale:1.25,shift:-.15,variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Rashi Hebrew",scale:1.25,shift:-.05,fallback:"serif",variationSettings:{wght:"100 900"}},{family:"Noto Serif",fallback:"serif",variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Sans",variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Sans Japanese",shift:-.06,variationSettings:{wght:"100 900"}},{family:"Noto Serif Japanese",fallback:"serif",shift:-.06,variationSettings:{wght:"100 900"}},{family:"Noto Sans Arabic",scale:.94,variationSettings:{wght:"100 900",wdth:"100"}},{family:"Noto Kufi Arabic",variationSettings:{wght:"100 900"}},{family:"Noto Naskh Arabic",variationSettings:{wght:"400 700"}},{family:"Noto Sans Phoenician"},{family:"Junicode",fallback:"serif",variationSettings:{wght:"300 700",wdth:"100",ENLA:"0"},styleset:{"Early-English-futhorc":12,"Elder-futhark":13,"Younger-futhark":14,"Long-branch-to-short-twig":15,"Latin-to-Gothic":19}}];var L=Object.fromEntries(Wt.map(n=>[n.family,n])),$e={display:"swap",weight:400,style:"normal"},st={},yt={family:"font-family",weight:"font-weight",scale:"--font-scale",shift:"--font-shift",styleset:"font-variant-alternates",letterSpacing:"--letter-spacing",lineHeight:"--line-height"},Kt=["shift","scale","letterSpacing"];function St(n){return n?typeof n=="object"?St(n.family):(n in st||(st[n]=ze(n),document.fonts.add(st[n])),st[n].load()):Promise.reject("No family given.")}function vt(n){return Promise.all(n.map(t=>St(t)))}function Ge(n){let t=`/kadmos/assets/fonts/${n.replaceAll(" ","")}.woff2`,e=Gt()?"woff2-variations":"woff2";return`url("${t}") format("${e}")`}function $t(){return"CSS"in window&&"supports"in CSS}function wt(){return $t()&&CSS.supports("font-variant-alternates","styleset(x)")}function Gt(){return $t()&&CSS.supports("font-variation-settings","normal")}function ze(n){let t=Object.assign({},$e,L[n]);if("styleset"in t&&wt()&&(document.styleSheets[0].insertRule(`@font-feature-values "${n}" {@styleset {`+Object.entries(t.styleset).map(([e,s])=>`${e}: ${s};`).join("")+"}}"),delete t.styleset),"variationSettings"in t){let e=Ye(t.variationSettings);delete t.variationSettings,Object.assign(t,e)}return new FontFace(n,t.url??Ge(n),t)}function Ye(n){let t={};return"wght"in n&&(t.weight=n.wght,n=X(n,"wght")),Object.keys(n).length>0&&(t.variationSettings=Object.entries(n).map(([e,s])=>`"${e}" ${s}`).join(",")),t}function zt(n,t,e=null){if(typeof t=="object")if("family"in t&&typeof t.family=="string"){zt(n,t.family,t);return}else throw new Error("Need properties.family of type string if family argument is omitted.");if(!(t in L))throw new Error(`Unknown family ${t}.`);Yt(n),Xe(n,t),xt(n,Je(e,t))}function Je(n,t){let e=Object.assign({},n),s=L[t];return"shift"in s&&(e.shift=s.shift+(n.shift??0)),"scale"in s&&(e.scale=s.scale*(n.scale??1)),e}function Qe(n){return L[n]}function xt(n,t){let e=!1;for(let[s,i]of Object.entries(t))if(s!=="family"){if(!(s in yt)){console.warn(`Unknown font property '${s}'`);continue}Kt.includes(s)&&(e=!0),s==="styleset"?"family"in t?Ze(n,i,t.family):console.error("Cannot set styleset without knowing family."):n.style.setProperty(yt[s],i)}R(e,n,"font-transform")}function Xe(n,t){let e=L[t];n.style.fontFamily=t+", "+(e.fallback??"system-ui, sans-serif"),xt(n,ht(e,Kt))}function Yt(n){for(let t of Object.values(yt))n.style.removeProperty(t)}function Ze(n,t,e){t=Array.isArray(t)?t:[t];let s=`styleset(${t.join(", ")})`;if(wt())n.style.setProperty("font-variant-alternates",s);else{let r=t.map(o=>L[e].styleset[o]).map(o=>`"ss${o.toString().padStart(2,"0")}"`).join(", ");n.style.setProperty("font-feature-settings",r)}}var V={};M(V,{decodeBase64BoolArray:()=>es,decodeBase64Number:()=>Qt,encodeBase64BoolArray:()=>ts,encodeBase64Number:()=>Jt});function ts(n){return Xt(ss(n))+"~"+Jt(n.length)}function es(n){let[t,e]=n.split("~");return ns(Zt(t),Qt(e))}function Jt(n){return Xt(is(n))}function Qt(n){return rs(Zt(n))}function ss(n){let t=new Array(Math.ceil(n.length/6)),e;for(let s=0;s<t.length;s++){e=0;for(let i=0;i<6;i++)n[6*s+i]&&(e+=1<<i);t[s]=e}return t}function ns(n,t){if(Math.ceil(t/6)!==n.length)throw new Error("Lengths of base 64 values and resultant length don't match.");let e=new Array(t);for(let[s,i]of n.entries())for(let r=0;r<6;r++){let o=6*s+r;if(o>=t)break;e[o]=(i&1<<r)!==0}return e}function is(n){let t=[];for(;n>0;)t.push(n&63),n>>=6;return t}function rs(n){let t=0;for(let[e,s]of n.entries())t+=s<<6*e;return t}function Xt(n){return String.fromCharCode(...n.map(t=>os(t)))}function Zt(n){let t=new Array(n.length);for(let e=0;e<n.length;e++)t[e]=as(n.charCodeAt(e));return t}function os(n){return n&=63,n<26?n+65:n<52?n+71:n<62?n+-5:n===62?45:95}function as(n){if(n>=65&&n<91)return n-65;if(n>=97&&n<123)return n-97+26;if(n>=48&&n<58)return n-48+53;if(n===45)return 62;if(n===95)return 63;throw new Error("Unknown base 64 char code.")}var g=class{constructor(){this._funcs=new Set}push(...t){for(let e of t)this._funcs.add(e)}remove(t){this._funcs.delete(t)}call(...t){for(let e of this._funcs)e.call(...t)}clear(){this._funcs.clear()}};var b=class{constructor(){this.settings={},this.keys=[]}static createFrom(t,e=null){let s=new this;return s.put(t,e),s}put(t,e=null){e??=Object.keys(t);for(let s of e)this.add(s,t[s])}extend(t){this.put(t.settings,t.keys)}add(t,e,s="end",i=null){if(this.settings[t]=e,s==="end")this.keys.push(t);else{let r;s==="begin"?r=0:(r=this.keys.indexOf(i),s==="afterKey"?r++:s!=="beforeKey"&&console.error("Invalid insert setting insert position.")),this.keys.splice(r,0,t)}}remove(t){this.settings[t].remove(),delete this.settings[t]}removeAll(){for(let t of Object.values(this.settings))t.remove();this.settings={},this.keys=[]}replace(t,e){this.settings[t].node.replaceWith(e.node),this.settings[t].remove(),this.settings[t]=e}replaceSelf(t){this.removeAll(),this.put(t.settings)}getValues(){return u.map(this.settings,t=>t.value)}setValues(t){for(let[e,s]of Object.entries(t))this.settings[e].value=s}getValue(t){if(!(t in this.settings))throw new Error("Key not in settings collection.");return this.settings[t].value}getDefault(t,e=null){return t in this.settings?this.settings[t].value:e}getNode(t){return this.settings[t].node}getSetting(t){return this.settings[t]}nodeList(){return this.keys.map(t=>this.settings[t].node)}addUpdateListener(t,...e){if(typeof t=="function")for(let s of Object.values(this.settings))s.updateListeners.push(t,...e);else{typeof t=="string"&&(t=[t]);for(let s of t)this.settings[s].updateListeners.push(...e)}}},F=class{static idCount=0;static updateEvent="change";node;valueNode;updateListeners;constructor(t){let e;if(this.constructor.isValueNode(t))e=t;else if(e=t.querySelector("input, textarea, select"),!this.constructor.isValueNode(e))throw new Error("Couldn't find element of type input, textarea or select.");this.node=l.createElement("div.setting.labeled-value-element"),this.node.append(t),this.valueNode=e,this.updateListeners=new g,this._onChange=this._onChange.bind(this),this.valueNode.addEventListener(this.constructor.updateEvent,this._onChange)}static createInput(t,e=null,s=null){let i=document.createElement("INPUT");i.type=t,s&&l.setAttrs(i,s);let r=new this(i);return e&&r.label(e),r}static createSelect(t,e={}){let s=document.createElement("select");l.setOptions(s,t,e);let i=l.createElement("div.styled-select");i.append(s);let r=new this(i);return e.id&&r.setId(e.id),e.label&&r.label(e.label),r}static isValueNode(t){let e=t.tagName;return e==="SELECT"||e==="TEXTAREA"||e==="INPUT"&&t.type!=="hidden"}isCheckbox(){return this.valueNode.tagName==="INPUT"&&this.valueNode.type==="checkbox"}get value(){return this.isCheckbox()?this.valueNode.checked:this.valueNode.value}set value(t){this.isCheckbox()?this.valueNode.checked=t:this.valueNode.value=t}_onChange(){this.updateListeners.call(this,this.value)}setDisabled(t){this.valueNode.disabled=t}setId(t={prefix:""}){let e=typeof t=="string"?t:this.constructor.generateId(t.prefix);this.valueNode.id=e;let s=this.node.querySelector("label");return s&&(s.htmlFor=e),e}static generateId(t=""){return"ve_"+t+this.idCount.toString().padStart(4,"0")}label(t){if(!t)return;let e=this.node.querySelector("label");e||(e=document.createElement("label"),this.valueNode.id||this.setId(),e.htmlFor=this.valueNode.id,this.node.prepend(e)),e.textContent=t}remove(){this.valueNode.removeEventListener(this.constructor.updateEvent,this._onChange),this.node.remove()}};l.registerTemplate("buttonGroupContainer",l.createElement("fieldset.button-group"));var I=class{static nameCount=0;node;inputs;constructor(t,e,s=!1){this.node=t,this.updateListeners=new g,this.inputs=Object.fromEntries(Array.from(this.node.querySelectorAll("INPUT")).map(i=>[i.value,i])),this.exclusive=e,this.decheckable=s,this._onChange=this._onChange.bind(this),this.node.addEventListener("change",this._onChange)}static from(t,{exclusive:e=!1,name:s=null,checked:i=null,disabled:r=null,decheckable:o=!1,label:a=null}={}){Array.isArray(t)&&(t=Object.fromEntries(t.map(p=>[p,p])));let c=Object.keys(t),h=e?"radio":"checkbox";s??=this.generateName();let d=l.getTemplate("buttonGroupContainer");e&&(d.setAttribute("role","radiogroup"),typeof i=="string"&&(i=[i]),!o&&!i&&(i=[c[0]])),i=u.subsetToBoolRecord(i??"none",c),r=u.subsetToBoolRecord(r??"none",c);for(let[p,C]of Object.entries(t)){let[w,Y]=l.button(h,p,C);w.name=e?s:`${s}_${p}`,w.disabled=r[p],w.checked=i[p],d.append(w,Y)}e&&o&&d.addEventListener("click",p=>{p.target.tagName==="INPUT"&&p.target.checked&&(p.target.checked=!1)});let m=new this(d,e,o);return a&&m.label(a),m}static generateName(){return this.nameCount++,"buttongroup_"+this.nameCount.toString().padStart(4,"0")}_onChange(){this.updateListeners.call(this,this.value)}buttonCount(){return Object.keys(this.inputs).length}disableIfSingleButton(t=null){this.buttonCount()===1?(this.setDisabled(!0),t!==null&&(this.value=t?Object.keys(this.inputs):[])):this.setDisabled(!1)}get value(){return u.filterKeys(this.inputs,t=>t.checked)}set value(t){t=u.subsetToBoolRecord(t,Object.keys(this.inputs));for(let[e,s]of Object.entries(this.inputs))s.checked=t[e]}setDisabled(t){for(let e of Object.values(this.inputs))e.disabled=t}label(t){let e=document.createElement("LEGEND");e.textContent=t,this.node.prepend(e)}remove(){this.node.addEventListener("change",this._onChange),this.node.remove()}};l.registerTemplate("slider",`<div class="slider-container">
    <span class="range-min"></span><span class="range-value"></span><span class="range-max"></span>
    <input type="range" class="form-range">
</div>`);var O=class extends F{static updateEvent="input";constructor(t,e,s){if(super(t),this.valueNode.tagName!=="INPUT"||this.valueNode.type!=="range")throw new Error("Couldn't find input type='range' element.");this.min=e,this.max=s,this.displayValue=this.displayValue.bind(this),this.updateProgress=this.updateProgress.bind(this),this.displayMinMax()}static create(t,e,s=null){let i=l.getTemplate("slider"),r=i.lastElementChild;r.min=t,r.max=e,r.setAttribute("step",1);let o=new this(i,t,e);return s!==null&&(o.value=s),o}_onChange(){super._onChange(),this.updateProgress(),this.displayValue()}updateProgress(){this.valueNode.style.setProperty("--range-progress",this.getProgress().toString())}getProgress(){return(this.value-this.min)/(this.max-this.min)}displayValue(){this.node.querySelector(".range-value").textContent=this.formatValue(this.value)}displayMinMax(){this.node.querySelector(".range-min").textContent=this.formatValue(this.min),this.node.querySelector(".range-max").textContent=this.formatValue(this.max)}isCheckbox(){return!1}set value(t){(this.min>t||this.max<t)&&console.warn("Slider value outside range."),super.value=t.toString(),this.displayValue(),this.updateProgress()}get value(){return parseFloat(this.valueNode.value)}formatValue(t){return(Math.round(t*100)/100).toString()}setMin(t){this.valueNode.value<t&&(this.valueNode.value=t,this._onChange()),this.min=t,this.valueNode.min=t,this.updateProgress(),this.displayMinMax()}setMax(t){this.valueNode.value>t&&(this.valueNode.value=t,this._onChange()),this.max=t,this.valueNode.max=t,this.updateProgress(),this.displayMinMax()}};var nt=class{_punishFactor=2;_manualPunish=1;_previousDampFactor=.5;constructor(t){this.items=t,this.rng=new H;let e=this.itemCount=t.length;this.hitCount=0,this.scores=new Array(e).fill(0),this.tries=new Array(e).fill(0),this.triesLeft=new Array(e).fill(1),this.totalTriesLeft=e,this.maxTriesLeft=e,this.currentIndex=this.rng.randInt(0,e),this.previousIndex=null}seed(t){this.rng.seed(t)}currentItem(){return this.items[this.currentIndex]}nextItem(){return this.previousIndex=this.currentIndex,this.currentIndex=this.rng.randIndexFromWeights(this.getWeights()),this.currentItem()}getWeights(){let t=this.triesLeft.slice();return this.previousIndex!==null&&(t[this.previousIndex]*=this._previousDampFactor),t}updateTotalTriesLeft(){let t=E.sum(this.triesLeft);t>this.totalTriesLeft&&(this.maxTriesLeft+=t-this.totalTriesLeft),this.totalTriesLeft=t}progress(){return 1-this.totalTriesLeft/this.maxTriesLeft}enterScore(t){let e=++this.tries[this.currentIndex];e===1&&this.hitCount++,this.scores[this.currentIndex]=Math.max(this.scores[this.currentIndex],t*this.scoreAtTryFactor(e)),this.triesLeft[this.currentIndex]+=this._triesBoost(t)-1,this.triesLeft[this.currentIndex]<=0&&(this.triesLeft[this.currentIndex]=0,this.itemCount--),this.updateTotalTriesLeft()}isEmpty(){return this.itemCount===0}_triesBoost(t){return this._punishFactor*(1-t)}scoreAtTryFactor(t){return 1/t}getItemIndex(t){return this.items.indexOf(t)}punish(t,e=1){this.triesLeft[t]+=this._manualPunish*e,this.updateTotalTriesLeft()}absoluteScore(){return E.sum(this.scores)}scoreString(t="ratio"){let e=this.absoluteScore(),s=`${ee(e,1,2)}/${this.hitCount}`,i=this.hitCount>0?te(e/this.hitCount):te(0);if(t==="ratio")return s;if(t==="percent")return i;if(t==="both")return`${s} (${i})`;console.error(`Unknown mode: ${t}`)}};function te(n,t=0){return String(ee(n*100,t))+"%"}function ee(n,t=0,e=1){let s=Math.pow(10,t)*e;return Math.floor(n*s)/s}function q(n,t,e,s,i){return n<t||e<t?n>e?e+1:n+1:s===i?t:t+1}function Et(n,t){if(n===t)return 0;if(n.length>t.length){let ge=n;n=t,t=ge}let e=n.length,s=t.length;for(;e>0&&n.charCodeAt(e-1)===t.charCodeAt(s-1);)e--,s--;let i=0;for(;i<e&&n.charCodeAt(i)===t.charCodeAt(i);)i++;if(e-=i,s-=i,e===0||s<3)return s;let r=0,o,a,c,h,d,m,p,C,w,Y,Lt,Ot,x=new Array(2*e);for(o=0;o<e;o++)x[2*o]=o+1,x[2*o+1]=n.charCodeAt(i+o);let Tt=x.length-1;for(;r<s-3;)for(w=t.charCodeAt(i+(a=r)),Y=t.charCodeAt(i+(c=r+1)),Lt=t.charCodeAt(i+(h=r+2)),Ot=t.charCodeAt(i+(d=r+3)),m=r+=4,o=0;o<Tt;o+=2)p=x[o],C=x[o+1],a=q(p,a,c,w,C),c=q(a,c,h,Y,C),h=q(c,h,d,Lt,C),m=q(h,d,m,Ot,C),x[o]=m,d=h,h=c,c=a,a=p;for(;r<s;)for(w=t.charCodeAt(i+(a=r)),m=++r,o=0;o<Tt;o+=2)p=x[o],x[o]=m=q(p,a,m,w,x[o+1]),a=p;return m}var T=class{constructor(t,e,s,i){this.type=t,this.displayString=e,this.properties=s,this.form=i}},k=class{constructor(t,e){this.value=t,this.maxDist=e,this.displayString=typeof t=="string"?t:t.toString()}static fromData(t,e){let s=e.maxDist??0,i=e.type;if(i==="number")return new It(t,s,e.distanceMode??"linear");if(i==="string")return new it(t,s,e.caseSensitive??!1,e.substitutions??{});if(i==="list"){let r,o={};return typeof t=="string"?r=t:("source"in t||console.error("Source of list property missing."),r=t.source,"alts"in t&&(o=t.alts)),new U(r,s,o,e)}else console.error(`Unknown property type "${e.type}"`)}grade(t){let e=this.gradeSingle(t,this.value);return[e,t.length>0?[this.markGradedText(t,e)]:[],[this.markGradedText(this.displayString,e)]]}static passes(t){return t>=.5}gradeSingle(t,e){let s=this.distance(t,e);return s<=this.maxDist?this.maxDist===0?1:Math.pow(2,-s/this.maxDist):0}markGradedText(t,e){let s=document.createElement("SPAN");return s.dataset.correct=e===1?"true":e>0?"partially":"false",s.textContent=t,s}distance(t,e){console.error("Not implemented.")}},It=class extends k{constructor(t,e,s="linear"){let i,r;typeof t=="string"?(i=parseFloat(t),isNaN(i)&&console.error(`Invalid number property value "${t}"`),r=t):(i=t,r=t.toString()),s==="log"&&i===0&&console.error('Invalid value 0 for NumberProperty with distanceMode "log"'),super(i,e),this.displayString=r,this.distanceMode=s}distance(t,e){return this.distanceMode==="linear"?Math.abs(t-e):Math.abs(Math.log(t/e))}},it=class extends k{constructor(t,e,s=!1,i={}){super(t,e),this.caseSensitive=s,this.substitutions=i}distance(t,e){return Et(this.standardizeString(t),this.standardizeString(e))}standardizeString(t){t=t.trim();for(let[e,s]of Object.entries(this.substitutions))t=t.replaceAll(new RegExp(e,"g"),s);return t=t.normalize("NFKD").replaceAll(/\p{M}/gu,""),this.caseSensitive||(t=t.toLowerCase()),t}},U=class extends it{constructor(t,e,s={},{listMode:i="best",caseSensitive:r=!1,splitter:o="[,;/]",excludeFromList:a=["\\(.*?\\)"],substitutions:c={}}){t=t.trim(),super(t,e,r,c),this.splitter=o,this.values=this.constructor.getValues(t,e,this.splitter,a),s?this.alternatives=u.map(s,h=>typeof h=="string"?[h]:h):this.alternatives={},this.listMode=i}static getValues(t,e,s,i){let r=[new rt(t)];for(let o of[...i,s])r=r.map(a=>a.split(o)).flat().map(a=>a.trim()).filter(a=>a.end>a.start);return r.length===0&&console.warn("No values in list."),r}grade(t){let e=new rt(t).split(this.splitter).map(o=>o.trim()),s=new Array(e.length).fill(0),i=new Array(this.values.length).fill(0);for(let[o,a]of this.values.entries())for(let[c,h]of e.entries()){let d=this.gradeSingle(h.str,a.str);a.str in this.alternatives&&(d=Math.max(d,...this.alternatives[a.str].map(m=>this.gradeSingle(h.str,m)))),d>0&&(i[o]=Math.max(i[o],d),s[c]=Math.max(s[c],d))}return[this.listMode==="best"?Math.max(...i):E.avg(s),this.markSubStrings(e,s),this.markSubStrings(this.values,i)]}markSubStrings(t,e){if(t.length===0)return[];let s=t[0].source,i=[],r=0;for(let[o,a]of t.entries())r<a.start&&i.push(document.createTextNode(s.substring(r,a.start))),a.start<a.end&&(i.push(this.markGradedText(a.str,e[o])),r=a.end);return r<s.length&&i.push(document.createTextNode(s.substring(r))),i}},rt=class n{constructor(t,e=0,s=null){t instanceof n&&(e+=t.start,s===null?s=t.end:s+=t.start,t=t.source),s===null&&(s=t.length),this.source=t,this.str=t.substring(e,s),this.start=e,this.end=s}split(t,e=!1){let s=[],i=this.str.matchAll(t),r=0;for(let o of i)!e&&r===o.index||(s.push(new this.constructor(this,r,o.index)),r=o.index+o[0].length);return(e||r<this.end-this.start)&&s.push(new this.constructor(this,r)),s}trim(){let t=this.str.match(/^\s*/)[0].length,e=this.str.match(/\s*$/)[0].length;return t===0&&e===0?this:new this.constructor(this.source,this.start+t,this.end-e)}};l.registerTemplates({eval:`<div class="item-eval">
    <span class="submitted"></span><span class="solution"></span>
</div>`,symbolContainer:`<div class="symbol-container">
    <div class="symbol-display-container"><span class="symbol"></span></div>
    <div class="symbol-label-container"><span class="symbol-label"></span></div>
</div>`});var W=class{constructor(t,e,s,i,r=null){this.dataset=t,this.properties=s,this.language=i,this.dealer=new nt(e),this.onFinish=new g,this.variant=r,this.updateProgressBar(),this.onInputKeydown=this.onInputKeydown.bind(this),this._show=this._show.bind(this),this.loadAndUpdateSymbolFont=this.loadAndUpdateSymbolFont.bind(this)}static genericSettings(){return b.createFrom({seed:F.createInput("text","Seed (optional)",{id:"game-seed"})})}setup({defaultWeight:t=null}={}){return this.setupSymbolContainer(),this.setupInputs(),this.setupEvals(),document.getElementById("item-next-button").textContent="Next",this.setupFontSettings(t)}getInputMode(t){return t==="real"||t==="integer"?"numeric":"text"}setupSymbolContainer(){let t=document.querySelector("#symbol-current .symbol");t.classList.add("symbol-string"),t.setAttribute("lang",this.dataset.metadata.lang),t.setAttribute("dir",this.dataset.metadata.dir)}setupInputs(){this.inputs=u.mapKeyArrayToValues(this.properties,e=>{let s=document.createElement("INPUT");return l.setAttrs(s,{type:"text",inputmode:this.getInputMode(this.dataset.properties[e].type),placeholder:this.dataset.properties[e].label}),this.language&&this.language!=="default"&&s.setAttribute("lang",this.language),s});let t=document.getElementById("game-inputs");t.replaceChildren(...Object.values(this.inputs)),t.addEventListener("keydown",this.onInputKeydown)}onInputKeydown(t){let e=t.target.closest("INPUT");e&&(t.key==="Enter"?e.nextElementSibling?e.nextElementSibling.focus():document.getElementById("item-submit-button").focus():t.key==="Backspace"&&t.target.value===""&&e.previousElementSibling&&(e.previousElementSibling.focus(),t.preventDefault()))}setupEvals(){this.evals={};let t=document.getElementById("game-evals");for(let e of this.properties){let s=l.getTemplate("eval");this.evals[e]=s,t.append(s)}}updateSymbolWeight(t){document.querySelector("#game-symbols").style.setProperty("--symbol-weight",t.toString())}loadAndUpdateSymbolFont(t=null){return t??=this.fontSettings.getValue("family"),v.loadFont(this.dataset.getFont(t,this.variant)).then(()=>this.updateSymbolFontFamily(t)).catch(e=>console.error(e))}updateSymbolFontFamily(t){t??=this.fontSettings.getValue("family"),document.querySelectorAll("#game-symbols .symbol-string").forEach(e=>{this.setSymbolFont(e,t)}),this.updateSymbolWeightRange(t)}updateSymbolWeightRange(t){let e=this.dataset.getFont(t,this.variant).family,s=v.getFontData(e),i=this.fontSettings.getSetting("weight");if(s.variationSettings&&s.variationSettings.wght){let[r,o]=s.variationSettings.wght.split(" ").map(a=>parseInt(a,10));i.setMin(r),i.setMax(o),l.show(i.node)}else l.hide(i.node)}setupFontSettings(t){t??=500;let e=O.create(100,900,t);return e.label("Weight"),this.fontSettings=b.createFrom({family:this.dataset.fontFamilySetting(),weight:e}),document.querySelector("#font-settings").replaceChildren(...this.fontSettings.nodeList()),this.fontSettings.addUpdateListener("weight",this.updateSymbolWeight),this.fontSettings.addUpdateListener("family",()=>l.transition(this.loadAndUpdateSymbolFont)),this.updateSymbolWeight(t),this.loadAndUpdateSymbolFont()}setSymbolFont(t,e){v.setFont(t,this.dataset.getFont(e,this.variant))}setReferenceItems(t){this.referenceItems=t}seed(t){this.dealer.seed(t)}cleanup(){this.clearItemDisplay(),this.updateProgressBar(0),document.getElementById("game-inputs").removeEventListener("keydown",this.onInputKeydown),document.getElementById("game-inputs").replaceChildren(),document.getElementById("game-evals").replaceChildren()}finish(){setTimeout(()=>this.cleanup(),100),this.onFinish.call(this)}currentItem(){return this.dealer.currentItem()}submitRound(){let t=0,e=this.currentItem();for(let[s,i]of Object.entries(this.inputs)){let r=this.evals[s],o=e.properties[s],[a,c,h]=o.grade(i.value);if(t+=a,!k.passes(a)){let d=this.getReferenceItems(e.form,s,i.value);if(d.length>0){let m=this.referenceItemsNodes(d,s);document.getElementById("game-symbols").append(...m),this.updateSymbolFontFamily(this.fontSettings.getValue("family"));for(let p of m)this.scaleItemNodeContents(p);for(let p of d)this.dealer.punish(this.dealer.getItemIndex(p),1/d.length)}}r.querySelector(".submitted").replaceChildren(...c),r.querySelector(".solution").replaceChildren(...h),l.classIfElse(o instanceof U&&o.listMode==="best",r,"best-mode")}t/=this.properties.length,this.dealer.enterScore(t),this.updateProgressBar(),this.dealer.isEmpty()&&(document.getElementById("item-next-button").textContent="Finish"),this.show("evals"),window.scrollY>0&&window.scrollTo({top:0,behavior:"smooth"})}getReferenceItems(t,e,s){if(!this.referenceItems)return[];let i=[];for(let[r,o]of this.referenceItems[t].entries()){let a=o.properties[e].grade(s)[0];k.passes(a)&&i.push([r,a])}return i.sort(([r,o],[a,c])=>c-o||r-a),i.length>0&&i[0][1]===1&&(i=i.filter(([r,o])=>o===1)),i.map(([r,o])=>this.referenceItems[t][r])}referenceItemsNodes(t,e){return t.map(s=>this.referenceItemNode(s,e))}referenceItemNode(t,e){let s=l.getTemplate("symbolContainer");return s.classList.add("symbol-reference"),s.querySelector(".symbol").classList.add("symbol-string"),this.updateItemNode(s,t,e,!1),s}updateItemNode(t,e,s=null,i=!0){s??=this.properties[0],t.querySelector(".symbol").textContent=e.displayString,t.querySelector(".symbol-label").textContent=e.properties[s].displayString,i&&this.scaleItemNodeContents(t)}scaleItemNodeContents(t){l.scaleToFit(t.querySelector(".symbol")),l.scaleToFit(t.querySelector(".symbol-label"))}clearInputs(){for(let t of Object.values(this.inputs))t.value=""}show(t){this.shown=t,requestAnimationFrame(this._show)}_show(){l.toggleShown(this.shown==="inputs",[document.getElementById("game-inputs"),document.getElementById("item-submit-button")],[document.getElementById("game-evals"),document.getElementById("item-next-button")]),l.toggleShown(this.shown==="inputs",null,document.querySelector("#symbol-current .symbol-label"),"visibility"),this.shown==="inputs"?(document.querySelectorAll("#game-symbols .symbol-reference").forEach(t=>{t.remove()}),this.focus()):document.getElementById("item-next-button").focus()}updateProgressBar(t=null){t??=this.dealer.progress(),document.getElementById("progress-bar").style.setProperty("--progress",t)}newRound(){if(this.dealer.isEmpty()){this.finish();return}this.dealer.nextItem(),this.displayItem(this.currentItem()),this.clearInputs(),this.show("inputs")}focus(){this.inputs[this.properties[0]].focus({preventScroll:!0})}displayItem(t){this.updateItemNode(document.getElementById("symbol-current"),t)}clearItemDisplay(){document.querySelector("#symbol-current .symbol").textContent="",document.querySelector("#symbol-current .symbol-label").textContent=""}};var P={arabic:{name:"Arabic",file:"arabic.json"},elements:{name:"Atomic Elements",file:"elements.json"},cyrillic:{name:"Cyrillic",file:"cyrillic.json"},elder_futhark:{name:"Elder Futhark",file:"elder_futhark.json"},greek:{name:"Greek",file:"greek.json"},hebrew:{name:"Hebrew",file:"hebrew.json"},japanese:{name:"Japanese Kana",file:"japanese.json"},phoenician:{name:"Phoenician",file:"phoenician.json"},younger_futhark:{name:"Younger Futhark",file:"younger_futhark.json"}};function se(n,t){let e=[],s=new Array(t).fill(!1);for(let[r,o]of n.entries()){if(o==="rest"){r!==n.length-1&&console.error("Can only have subset 'rest' at the end."),e.push(Q(s,c=>!c));break}let a=[];for(let c of cs(o))if(a.push(c),c!==null){if(s[c])throw new Error(`Duplicate subset index ${c}.`);s[c]=!0}e.push(a)}let i=Q(n,r=>!r);if(i.length!==0)throw new Error(`Not all indices were covered: missing ${i}.`);return e}function cs(n){if(typeof n=="string")return hs(n);if(typeof n=="number")return[n];if(!Array.isArray(n))throw new Error("Invalid indices datatype: need string, number or number[].");return us(n)&&console.warn("Indices contain duplicates."),n}function us(n){return new Set(n).size!==n.length}function hs(n){return[].concat(...n.split(",").map(ds))}function ds(n){let t=n.split(":").map(fs);if(t.length===1)return t;if(t.length===0||t.length>3)throw new Error("Invalid range, 2-3 numbers.");let e=t[0],s=t[t.length-1],i=t.length===3?t[1]:1;if(s<e||i<1)throw new Error("Invalid range, must have start <= stop and step >= 1.");return A(e,s+1,i)}function fs(n){let t=parseInt(n);if(isNaN(t))throw new Error("Not a number.");return t}function ne(n,t){let e=new Array(t);for(let[s,i]of n.entries())for(let[r,o]of i.entries())e[o]=[s,r];return e}var K=class{constructor(){this.sizes=new WeakMap,this.updateSize=this.updateSize.bind(this),this.updateListeners=new g,this.observer=new ResizeObserver(t=>{t.forEach(this.updateSize),this.updateListeners.call(this,t.map(e=>e.target))})}watch(t){for(let e of t)this.observer.observe(e)}unwatch(t){for(let e of t)this.observer.unobserve(e),this.sizes.has(e)&&this.sizes.delete(e)}updateSize(t){this.sizes.set(t.target,t.contentBoxSize[0])}getSize(t){return this.sizes.get(t)}teardown(){this.observer.disconnect(),this.updateListeners.clear()}},$=class{constructor({watcher:t=null,uniformFactor:e=1/0,dimension:s="width"}={}){this.watcher=t??new K,this.updateParents=this.updateParents.bind(this),this.watcher.updateListeners.push(this.updateParents.bind(this)),this.dimension=s,this.uniformFactor=e,this.scales=new Map,this.minScale=1/0,this.maxScale=-1/0,this.childrenFromParent=new WeakMap}fit(t){this._add(t),this.updateChildren(t)}_add(t){for(let e of t){let s=e.parentElement;this.childrenFromParent.has(s)||this.childrenFromParent.set(s,new Set),this.childrenFromParent.get(s).add(e)}this.watcher.watch(t.map(e=>e.parentElement))}updateParents(t){this.updateChildren(t.map(e=>Array.from(this.childrenFromParent.get(e))).flat())}updateChildren(t=null){let e=this.minScale,s=this.maxScale;if(t)for(let i of t)this._updateScale(i);else this.scales.forEach((i,r)=>{this._updateScale(r)});!t||(this.minScale!==e||this.maxScale!==s)&&(this.uniformityActive()||this.uniformityActive(e,s))?this._applyAllScales():this._applyScales(t)}uniformityActive(t=this.minScale,e=this.maxScale){return e/t>this.uniformFactor}_updateScale(t){let e=this.watcher.getSize(t.parentElement);if(!e)return;let s=ps(t,e,this.dimension);s!==null&&(this.scales.set(t,s),s>0&&s<this.minScale?this.minScale=s:s>this.maxScale&&(this.maxScale=s))}_applyScale(t,e=null){e??=this.scales.get(t),t.style.scale=Math.min(e,this.minScale*this.uniformFactor)}_applyScales(t){for(let e of t)this._applyScale(e)}_applyAllScales(){for(let[t,e]of this.scales)this._applyScale(t,e)}teardown(){this.scales.clear(),this.watcher.updateListeners.remove(this.updateParents)}};function ps(n,t,e){if(!["width","height","both"].includes(e))throw new Error(`Invalid scale dimension ${e}.`);let s=1;if(e==="both"||e==="width"){let i=ie(n.offsetWidth,t.inlineSize);if(i===null)return null;s=Math.min(s,i)}if(e==="both"||e==="height"){let i=ie(n.offsetHeight,t.blockSize);if(i===null)return null;s=Math.min(s,i)}return s}function ie(n,t,e=!1){if(n===0||isNaN(n)||isNaN(t))return null;let s=t/n;return e?s:Math.min(s,1)}var kt=E.range,re={buttonMinWidth:"--button-min-width",buttonMaxWidth:"--button-max-width",symbolSize:"--symbol-size",labelGap:"--label-gap",symbolMinWidth:"--symbol-min-width"},N=class{constructor(t){if(!Array.isArray(t))throw new Error("Invalid argument: SelectorBlock.items must be an array.");this.items=t,this.updateListeners=new g,this._bindListeners(),this._setupButtons()}_bindListeners(){this._onButtonClick=this._onButtonClick.bind(this),this._onRangePointerDown=this._onRangePointerDown.bind(this),this._onRangePointerMove=this._onRangePointerMove.bind(this),this._onRangePointerUpCancel=this._onRangePointerUpCancel.bind(this)}_setupButtons(){this._buttonIdPrefix=l.uniqueIdPrefix("selectorButton"),this.checked=new Array(this.items.length).fill(!0),this.buttons=kt(this.items.length).map(t=>this._createButton(t,!0))}_createButton(t,e){let s=l.createElement("div.selector-button"),i=this._buttonIdPrefix+t.toString();return l.setAttrs(s,{id:i,role:"checkbox",tabindex:0,"aria-checked":e,"aria-labelledby":i}),s.dataset.index=t.toString(),s}_setupNode(){this.node=l.createElement("div.selector-block"),this.node.append(...this.buttons)}_setupButtonWatcher(){this.buttonWatcher=new K,this.buttonWatcher.watch(this.buttons)}_setupContentFitter(){this.buttonWatcher||this._setupButtonWatcher(),this.contentFitter=new $({watcher:this.buttonWatcher,uniformFactor:1.5,dimension:"width"}),this.contentFitter.fit(this.buttons.map(t=>t.querySelector(".selector-button-content")))}_setupLabelFitter(){this.labelFitter=new $({watcher:this.buttonWatcher,dimension:"width"}),this.labelFitter.fit(this.buttons.map(t=>t.querySelector(".selector-button-label")))}setupButtonContents(t){this.items.forEach((e,s)=>{let i=t(e,s);i.classList.add("selector-button-content"),this.buttons[s].prepend(i)})}labelButtons(t){for(let[e,s]of this.items.entries())this.labelButton(e,t(s,e));this.labelFitter||this._setupLabelFitter(),this.labelFitter.updateChildren()}labelButton(t,e){let s=this.buttons[t],i=s.querySelector(".selector-button-label");i||(i=l.createElement("span.selector-button-label"),s.append(i)),i.textContent=e}finishSetup(){this._setupNode(),this._setupListeners(),this._setupButtonWatcher(),this._setupContentFitter()}_callUpdateListeners(){this.updateListeners.call(this,this.checked)}updateButtonContents(t){for(let[e,s]of this.buttons.entries())t(s.querySelector(".selector-button-content"),this.items[e],e);this.contentFitter.updateChildren()}applyStyle(t){"buttonWidth"in t&&(t.buttonMinWidth=t.buttonWidth,t.buttonMaxWidth=t.buttonWidth,delete t.buttonWidth);for(let[e,s]of Object.entries(t))e in re||console.error(`Invalid selector block style property ${e}.`),this.node.style.setProperty(re[e],s)}_setARIAProperty(t,e){for(let[s,i]of this.buttons.entries())l.setARIA(i,t,e(this.items[s],s))}setChecked(t){this.items.forEach((e,s)=>this._setButtonChecked(s,t(e,s),{updateIfDisabled:!0,callUpdateListeners:!1}))}setDisabled(t){this._setARIAProperty("disabled",t)}getChecked(t=!1){return this.checked.map((e,s)=>e&&(t||!this.isDisabled(s)))}checkedCount(t=!1){return this.checked.reduce((e,s,i)=>s&&(t||!this.isDisabled(i))?e+1:e,0)}getCheckedItems(){return this.items.filter((t,e)=>this.checked[e])}getDisabled(){return this.buttons.map(t=>t.getAttribute("aria-disabled")==="true")}_setButtonChecked(t,e,{updateIfDisabled:s=!1,callUpdateListeners:i=!0}={}){!s&&this.isDisabled(t)||(l.setARIA(this.buttons[t],"checked",e),this.checked[t]=e,i&&this._callUpdateListeners())}isChecked(t,e=!1){return this.checked[t]&&(e||!this.isDisabled(t))}isDisabled(t){return l.getARIA(this.buttons[t],"disabled")==="true"}_toggleItems(t,{updateIfDisabled:e=!1,callUpdateListeners:s=!0}={}){let i=t.findIndex(r=>!this.isChecked(r))!==-1;for(let r of t)this._setButtonChecked(r,i,{updateIfDisabled:e,callUpdateListeners:!1});s&&this._callUpdateListeners()}_setupListeners(){this.node.addEventListener("click",this._onButtonClick),this.node.addEventListener("keypress",this._onButtonClick),this._resetRangeSelection(),this.node.addEventListener("pointerdown",this._onRangePointerDown)}_removeListeners(){this.node.removeEventListener("click",this._onButtonClick),this.node.removeEventListener("keypress",this._onButtonClick),this.node.removeEventListener("pointerdown",this._onRangePointerDown),this.node.removeEventListener("pointermove",this._onRangePointerMove)}_buttonFromTarget(t){return t.closest(".selector-button")}_rangeTargetIndex(t){let e=this._buttonFromTarget(t);return e?parseInt(e.dataset.index):null}_onButtonClick(t){if(t.type==="keypress"&&t.key!=="Enter")return;let e=t.target.closest(".selector-button, .selector-button-gap");if(e&&e.classList.contains("selector-button")){let i=e.dataset.index;this._setButtonChecked(i,!this.isChecked(i))}let s=this._rangeTargetIndex(t.target);s!==null&&(t.type==="click"&&t.detail%2===0&&this.lastClickTargetIndex===s&&this._toggleItems(kt(this.buttons.length),{updateIfDisabled:!0}),this.lastClickTargetIndex=s)}_resetRangeSelection(){this._removeRangeListeners(),this.rangeIndices&&this._buttonsRemoveClass(this.rangeIndices,"active"),this.rangeIndices=null,this.rangeStartIndex=null,this.rangeStopIndex=null,this.isRangeSelecting=!1}_onRangePointerMove(t){if(!this.isRangeSelecting)return;let e=document.elementFromPoint(t.clientX,t.clientY),s=this._rangeTargetIndex(e);s===null||this.rangeStopIndex===s||(this.rangeStartIndex??=s,this.rangeStopIndex=s,this._updateRangeSelection())}_onRangePointerDown(t){let e=this._rangeTargetIndex(t.target);e!==null&&(this.rangeStartIndex=e,this.rangeStopIndex=e,this._updateRangeSelection()),this.isRangeSelecting=!0,this._addRangeListeners()}_onRangePointerUpCancel(t){this.isRangeSelecting&&(t.type==="pointerup"&&this.rangeIndices&&this.rangeStartIndex!==this.rangeStopIndex&&this._toggleItems(this.rangeIndices),this._resetRangeSelection())}_updateRangeSelection(){this.rangeIndices&&this._buttonsRemoveClass(this.rangeIndices,"active"),this.rangeStartIndex!==null&&this.rangeStopIndex!==null?(this.rangeIndices=this._getRangeIndices(this.rangeStartIndex,this.rangeStopIndex),this._buttonsAddClass(this.rangeIndices,"active")):this.rangeIndices=null}_getRangeIndices(t,e){return e<t&&([t,e]=[e,t]),kt(t,e+1)}_addRangeListeners(){this.node.addEventListener("pointermove",this._onRangePointerMove),document.addEventListener("pointerup",this._onRangePointerUpCancel),document.addEventListener("pointercancel",this._onRangePointerUpCancel)}_removeRangeListeners(){this.node.removeEventListener("pointermove",this._onRangePointerMove),document.removeEventListener("pointerup",this._onRangePointerUpCancel),document.removeEventListener("pointercancel",this._onRangePointerUpCancel)}_buttonsRemoveClass(t,e){l.removeClass(this._buttonsFromIndices(t),e)}_buttonsAddClass(t,e){l.addClass(this._buttonsFromIndices(t),e)}_buttonsFromIndices(t){return t.map(e=>this.buttons[e])}teardown(){this._removeListeners(),this.buttonWatcher.teardown(),this.contentFitter.teardown(),this.labelFitter&&this.labelFitter.teardown()}};var G=class{constructor(t,e,s=null){this.items=t,this.subsets=se(e,t.length),this.subsetsInverse=ne(this.subsets,t.length),this.blocks=this.subsets.map((i,r)=>{let o=i.map(a=>this.items[a]);return s?s(o,r):new N(o)}),this.updateListeners=new g,this._callUpdateListeners=this._callUpdateListeners.bind(this),this.blocks.forEach(i=>i.updateListeners.push(this._callUpdateListeners))}_callUpdateListeners(){this.updateListeners.call(this,this.getChecked())}_buttonCallback(t,e){this.blocks.forEach((s,i)=>{t(s,(r,o,a)=>e(r,o,this.subsets[i][a]))})}_itemCallback(t,e){this.blocks.forEach((s,i)=>{t(s,(r,o)=>e(r,this.subsets[i][o]))})}setupButtonContents(t){this._itemCallback((e,s)=>e.setupButtonContents(s),t)}_setupNode(){this.node=l.createElement("div.selector"),this.node.append(...this.blocks.map(t=>t.node))}finishSetup(){this.blocks.forEach(t=>t.finishSetup()),this._setupNode()}updateButtonContents(t){this._buttonCallback((e,s)=>e.updateButtonContents(s),t)}labelButtons(t){this._itemCallback((e,s)=>e.labelButtons(s),t)}setChecked(t){this._itemCallback((e,s)=>e.setChecked(s),t)}setDisabled(t){this._itemCallback((e,s)=>e.setDisabled(s),t)}getCheckedItems(){let t=this.getChecked();return this.items.filter((e,s)=>t[s])}getChecked(t=!1){let e=this.blocks.map(s=>s.getChecked(t));return A(this.items.length).map(s=>{let[i,r]=this.subsetsInverse[s];return e[i][r]})}checkedCount(t=!1){return J(this.blocks.map(e=>e.checkedCount(t)))}getDisabled(){let t=this.blocks.map(e=>e.getDisabled());return A(this.items.length).map(e=>{let[s,i]=this.subsetsInverse[e];return t[s][i]})}isChecked(t){let[e,s]=this.subsetsInverse[t];return this.blocks[e].isChecked(s)}isDisabled(t){let[e,s]=this.subsetsInverse[t];return this.blocks[e].isDisabled(s)}applyStyle(t){this.blocks.forEach(e=>e.applyStyle(t))}teardown(){this.blocks.forEach(t=>t.teardown())}};l.registerTemplate("headingElement",'<div class="heading-element"><span class="heading-element-number"></span><span class="heading-element-symbol"></span></div>');var ms="./json/datasets/",oe="greek",gs={gameHeading:"Kadmos",terms:{letter:"letter"},lang:"en",dir:"ltr"},ae=["letter","letters"],bs={data:{default:"Default"},exclusive:!1},ys={keys:["en"]},Ss={en:"English",de:"German"},z=class{static _cache={};constructor(t){this.name=t.name,this.metadata=this.processMetadata(t.metadata),this.processFonts(t.fonts),this.gameConfig=t.game??{},this.forms=this.processForms(t.forms),this.properties=t.properties,this.selectorData=this.processSelectorData(t.selector),this.variants=this.processVariants(t.variants),this.languages=t.languages??ys,this.languages.default??=this.languages.keys[0],this.items=this.processItems(t.items)}static fetch(t){return t in P?t in this._cache?Promise.resolve(this._cache[t]):fetch(ms+P[t].file).then(e=>e.json()).then(e=>{let s=new this(e);return s.key=t,this._cache[t]=s,s}).catch(e=>console.error(e)):(console.error(`Invalid dataset key "${t}".`),null)}processSelectorData(t){return t??={},t.blocks??=t.block?[t.block]:[{mode:"flex"}],t}processMetadata(t){return t=Object.assign({},gs,t),t.terms.letter??="letter",t.terms.letters??=t.terms.letter+"s",t}processForms(t){t??=bs;for(let[e,s]of Object.entries(t.data))typeof s=="string"&&(t.data[e]={label:s});return t}processVariants(t){if(!t||!t.data)return null;for(let[e,s]of Object.entries(t.data))typeof s=="string"&&(t.data[e]={label:s}),t.data[e].lang??=e;return t}getGameSettings(t){let e={};return this.hasSetting("properties")&&(e.properties=this.propertySetting(t.properties)),this.hasSetting("language")&&(e.language=this.languageSetting(t.language)),b.createFrom(e)}getFilterSettings(t){let e={};return this.hasVariants()&&(e.variant=this.variantSetting(t.variant)),this.hasSetting("forms")&&(e.forms=this.formsSetting(t.forms)),b.createFrom(e)}propertySetting(t=null){return I.from(u.map(this.properties,e=>e.label),{label:"Properties",checked:t??u.map(this.properties,e=>!!e.active)})}languageSetting(t=null){return I.from(u.onlyKeys(Ss,this.languages.keys),{label:"Language",checked:t??this.languages.default,exclusive:!0})}ungroupedForms(){return u.filter(this.forms.data,t=>!("groupWith"in t))}formsSetting(t=null){if(!this.hasSetting("forms"))return null;let e=this.forms.label??(this.forms.exclusive?"Form":"Forms"),s=this.ungroupedForms();return I.from(u.map(s,i=>i.label),{label:e,exclusive:this.forms.exclusive,checked:t??u.map(s,i=>i.active??!this.forms.exclusive)})}variantSetting(t=null){return F.createSelect(u.map(this.variants.data,e=>e.label),{label:"Variant",selected:t??this.variants.default??Object.keys(this.variants.data)[0],groups:this.variants.groups?Object.values(this.variants.groups):[]})}hasSetting(t){switch(t){case"properties":return Object.keys(this.properties).length>1;case"language":return this.languages.keys.length>1;case"variant":return this.hasVariants();case"forms":return Object.keys(this.ungroupedForms()).length>1;case"font-family":return Object.keys(this.fonts).length>1;default:throw new Error(`Invalid settings key ${t}.`)}}hasVariants(){return!!this.variants}getLang(t=null){return t?this.variants.data[t].lang??t:this.metadata.lang}getDir(){return this.metadata.dir}getSelector(t=null){let e=new G(this.items,this.selectorData.blocks.map(o=>o.indices??"rest")),s=this.getLang(t),i=this.getDir(),r=this.getSelectorDisplayFont();return e.setupButtonContents(o=>{let a=l.createElement("span.symbol-string");return a.append(...Object.values(o.getFormNodes())),v.setFont(a,r),s&&(a.lang=s),i&&(a.dir=i),a}),this.selectorData.label&&e.labelButtons(o=>o.getSelectorLabel(this.selectorData.label)),e.finishSetup(),e.node.dir=i,this.selectorData.style&&e.applyStyle(this.selectorData.style),this.selectorData.blocks.forEach((o,a)=>{o.style&&e.blocks[a].applyStyle(o.style)}),e}applySettings(t,e){let s=this.getFormsFromSettingsValue(e.forms);t.updateButtonContents(r=>{r.querySelectorAll(".symbol-form").forEach(o=>{let a=s.includes(o.dataset.form);l.toggleShown(a,o)})});let i=this.getVariantItemIndices(e.variant);t.setDisabled((r,o)=>!i.has(o)||r.getForms(s).length===0)}getVariantItemIndices(t){if(!t)return new Set(A(this.items.length));let e=new Set;return this.items.forEach((s,i)=>{s.variants.has(t)&&e.add(i)}),e}getFormsFromSettingsValue(t){if(!t)return Object.keys(this.forms.data);let e=t.slice();for(let[s,i]of Object.entries(this.forms.data))if("groupWith"in i&&t.includes(i.groupWith)){let r=e.indexOf(i.groupWith);r!==-1&&e.splice(r+1,0,s)}return e}getVariantFontModification(t,e){if(e){let s=this.variants.data[e].fonts;if(s&&t in s)return s[t]}return null}getFont(t,e=null){return t?(typeof t=="string"&&(t={key:t}),"family"in t&&console.warn(`Found family property "${t.family}" in font: Will be overwritten!`),t.key??=this._defaultFontKey,t.key in this.fonts||(console.error(`Unknown font key "${t.key}".`),t.key=this._defaultFontKey),u.withoutKeys(Object.assign({},this.fonts[t.key],this.getVariantFontModification(t.key,e),t),["key","default","label"])):this.defaultFont()}getSelectorDisplayFont(t){return this.getFont(this.selectorData.font,t)}processFonts(t){this.fonts=t;let e=Object.entries(t).find(([s,i])=>i.default);this._defaultFontKey=e?e[0]:Object.keys(t)[0]}defaultFont(){return this.fonts[this._defaultFontKey]}fontFamilySetting(t=null){let e=I.from(u.map(this.fonts,s=>s.label??s.family),{label:"Font",exclusive:!0,checked:t??this._defaultFontKey});return e.node.classList.add("font-family-setting"),e}processItems({properties:t,data:e,symbolType:s="string"}){let i=new Array(e.length);for(let[r,o]of e.entries()){let a=this.processDisplayForms(o[0]),c;this.hasVariants()&&(c=this.processItemVariants(o[1]));let h=u.fromKeysValues(t,o.splice(this.hasVariants()?2:1),!1);i[r]=new _t(s,a,h,c)}return i}processItemVariants(t){if(!t||t==="*")return Object.keys(this.variants.data);if(Array.isArray(t))return t;let e=t.substring(0,2)!=="*-";e||(t=t.substring(2));let s=u.map(this.variants.data,()=>!e);for(let i of t.split(","))if(i in this.variants.data)s[i]=e;else if(this.variants.groups&&i in this.variants.groups)for(let r of this.variants.groups[i])s[r]=e;return u.filterKeys(s,i=>i)}processDisplayForms(t){if(Object.keys(this.forms.data).length===1)return Array.isArray(t)&&(t=t[0]),Object.fromEntries([[Object.keys(this.forms.data)[0],t]]);if(typeof t=="string"&&(t=t.split("")),Array.isArray(t)){let e={},s=Object.keys(this.forms.data);for(let[i,r]of t.entries())r&&(e[s[i]]=r);return e}if(typeof t!="object")throw new Error("Invalid display format: need array or object.");return u.onlyKeys(t,Object.keys(this.forms.data),!0)}getQuizItems(t,e,s,i=null){let r=[];for(let o of t){let a=o.getDisplayStrings(e),c=o.getItemProperties(s,this.properties,i);r.push(...Object.entries(a).map(([h,d])=>new T(o.type,d,c,h)))}return r}referencePropsData(){let t=Object.assign({},this.properties);for(let[e,s]of Object.entries(t))if("referenceMaxDist"in s){let i=Object.assign({},s);i.maxDist=s.referenceMaxDist,t[e]=i}return t}getReferenceItems(t,e=null){let s,i=this.referencePropsData();if(this.forms.exclusive){let r=this.items.map(o=>o.getItemProperties(t,i,e));return u.map(this.forms.data,(o,a)=>this.items.map((c,h)=>new T(c.type,c.getFormsDisplayString([a]),r[h],a)))}else return s=this.items.map(r=>new T(r.type,r.getFormsDisplayString(Object.keys(this.forms.data)),r.getItemProperties(t,i,e),"all")),u.map(this.forms.data,()=>s)}setupGameHeading(t){let e=this.metadata.gameHeading;if(v.setFont(t,this.getFont(e.font)),this.name==="Atomic Elements"){let s=document.createElement("div");s.classList.add("element-heading-container");let i=[];for(let[r,o]of[[19,"K"],[85,"At"],[42,"Mo"],[16,"S"]]){let a=l.getTemplate("headingElement");a.querySelector(".heading-element-symbol").textContent=o,a.querySelector(".heading-element-number").textContent=r,i.push(a)}s.replaceChildren(...i),t.replaceChildren(s)}else t.replaceChildren(e.string);t.setAttribute("lang",e.lang??this.metadata.lang),t.setAttribute("dir",e.dir??this.metadata.dir)}},_t=class{constructor(t,e,s,i=null){this.type=t,this.displayForms=e,this.properties=s,this.variants=new Set(i)}getDisplayStrings(t){return u.onlyKeys(this.displayForms,t)}getItemProperties(t,e,s=null){let i={};for(let r of t){if(!(r in this.properties)){console.error(`Missing property key "${r}".`);continue}i[r]=this.properties[r]}if(s)for(let r of t){let o=r+"_"+s;this.properties[o]&&(i[r]=this.properties[o])}return u.map(i,(r,o)=>k.fromData(r,e[o]))}getFormNode(t){let e=l.createElement("span.symbol-form");return e.dataset.form=t,e.textContent=this.displayForms[t],e}getForms(t=null){return t?t.filter(e=>e in this.displayForms):Object.keys(this.displayForms)}getFormNodes(t=null){return u.mapKeyArrayToValues(this.getForms(t),e=>this.getFormNode(e))}getFormsDisplayString(t){return Object.values(this.getDisplayStrings(t)).join("")}countQuizItems(t){return t.reduce((e,s)=>s in this.displayForms?e+1:e,0)}getSelectorLabel({property:t=null,splitFirst:e=!0,splitter:s="[,;/]"}={}){let i=this.properties[t];return e?i.split(new RegExp(`s*(${s})s*`))[0]:i}};var y=null,f=null,_=new b,j=new b,Ct=new b,S=null,le=null;function de(){vs(),xs(),Ct.replaceSelf(W.genericSettings()),document.getElementById("generic-game-settings").append(...Ct.nodeList()),window.addEventListener("popstate",()=>l.transition(he)),ws(),he(!1)}function vs(){document.getElementById("start-game-button").addEventListener("click",()=>l.transition(pe)),document.getElementById("stop-game-button").addEventListener("click",()=>{y.finish()}),document.getElementById("item-submit-button").addEventListener("click",()=>{l.transition(()=>{y.submitRound()},["game"])}),document.getElementById("item-next-button").addEventListener("click",()=>{l.transition(()=>{y.newRound()},["game"])})}function ws(){let n=document.getElementById("datasetSelect");l.setOptions(n,u.map(P,t=>t.name)),n.addEventListener("change",t=>{let e=t.target.value;z.fetch(e).then(s=>l.transition(()=>fe(s))).catch(console.error)})}function Ft(n){n||l.showPage(document.getElementById("game-filters")),l.toggleShown(n,[document.getElementById("game-container"),document.getElementById("stop-game-button"),document.getElementById("progress-bar")],[document.getElementById("new-game-settings")])}function xs(){le=b.createFrom({accentColor:ks(),colorMode:_s()}),document.querySelector("#page-settings .settings").replaceChildren(...le.nodeList()),document.getElementById("open-settings-button").addEventListener("click",()=>{l.transition(Es,["page-settings","ease-in"])}),document.getElementById("close-settings-button").addEventListener("click",()=>{l.transition(Is,["page-settings","ease-out"])})}function Es(){l.show(document.getElementById("page-settings-container")),document.documentElement.style.overflowY="hidden"}function Is(){l.hide(document.getElementById("page-settings-container")),document.documentElement.style.removeProperty("overflow-y")}function ks(){let n=window.localStorage.getItem("accentHue")||250;ce(n);let t=O.create(0,360,n);return t.label("Accent Hue"),t.updateListeners.push(e=>ce(e)),t.node.id="accentHueSlider",t}function ce(n){document.documentElement.style.setProperty("--accent-hue",n),window.localStorage.setItem("accentHue",n)}function _s(){let n=window.matchMedia("(prefers-color-scheme: dark)"),t=window.localStorage.getItem("colorMode")||(n.matches?"dark":"light");At(t);let e=I.from({dark:"Dark Mode",light:"Light Mode"},{label:"Color Mode",exclusive:!0,checked:t});return n.addEventListener("change",s=>{let i=s.matches?"dark":"light";e.value=[i],At(i)}),e.updateListeners.push(s=>l.transition(()=>At(s,{updateLocalStorage:!0}))),e}function At(n,{updateLocalStorage:t=!1}={}){if(n!=="dark"&&n!=="light")throw new Error(`Invalid color mode ${n}, use dark or light.`);l.classIfElse(n==="dark",document.documentElement,"dark-mode","light-mode"),t&&window.localStorage.setItem("colorMode",n)}function fe(n){f=n,l.setSearchParams({dataset:n.key}),As();let t=Ps(),e=f.metadata.gameHeading;return vt([f.getFont(e.font),f.getSelectorDisplayFont()]).then(()=>{Cs(),l.showPage(document.getElementById("game-filters")),f.setupGameHeading(document.querySelector("#game-heading h1")),Ls(t),Fs(t)})}function As(){document.title=f?`${f.name} - Kadmos`:"Kadmos"}function Cs(){for(let n of ae){let t=f.metadata.terms[n];document.querySelectorAll(".term-"+n).forEach(e=>{e.textContent=t})}}function Fs(n={}){S&&(S.teardown(),S.node.remove()),S=f.getSelector(),document.getElementById("dataset-filter-settings").append(S.node),n.checked&&S.setChecked((t,e)=>n.checked[e]),f.applySettings(S,_.getValues()),S.updateListeners.push(ue,ot),ue()}function Ls(n){_.replaceSelf(f.getFilterSettings(n)),j.replaceSelf(f.getGameSettings(n)),_.addUpdateListener(ot),j.addUpdateListener(ot),_.addUpdateListener(()=>l.transition(()=>{f.applySettings(S,_.getValues())})),document.getElementById("dataset-filter-settings").replaceChildren(..._.nodeList()),document.getElementById("dataset-game-settings").replaceChildren(...j.nodeList())}function Os(){return f.hasSetting("forms")?f.getFormsFromSettingsValue(_.getValue("forms")):Object.keys(f.forms.data)}function Ts(){return j.getDefault("properties",Object.keys(f.properties))}function ue(){document.querySelector("#game-settings-pages .pages-next-button").disabled=S.checkedCount()===0}function pe(){y&&y.cleanup(),ot();let n=Ts(),t=j.getDefault("language",null),e=f.getQuizItems(S.getCheckedItems(),Os(),n,t),s=f.getReferenceItems(n,t),i=f.hasVariants()?_.getValue("variant"):null;y=new W(f,e,n,t,i);let r=Ct.getValue("seed");r&&y.seed(r),y.setReferenceItems(s),y.onFinish.push(()=>{Ft(!1)}),y.setup({defaultWeight:f.gameConfig.defaultWeight}).then(()=>{Ft(!0),y.newRound(),y.focus()}).catch(o=>console.error(o))}function he(){let n=new URLSearchParams(location.search),t=n.get("dataset");(!t||!(t in P))&&(t=oe),document.getElementById("datasetSelect").value=t,z.fetch(t).then(e=>fe(e)).then(()=>{["1","true"].includes(n.get("play"))?pe():Ft(!1)})}function me(n=null){return"settings_"+(n||f.key)}function ot(){l.setSearchParams({dataset:f.key});let n=Object.assign({checked:V.encodeBase64BoolArray(S.getChecked())},_.getValues(),j.getValues());window.localStorage.setItem(me(),JSON.stringify(n))}function Ps(){let n=window.localStorage.getItem(me());if(!n)return{};try{let t=JSON.parse(n);return typeof t.checked=="string"&&(t.checked=V.decodeBase64BoolArray(t.checked)),t}catch(t){return console.error(t),{}}}(function(){Ns(),l.transition(de),document.querySelectorAll(".ribbon").forEach(n=>{js(n,n.classList.contains("ribbon-closable"))}),document.querySelectorAll(".pages-container").forEach(n=>{l.setupPages(n)})})();function Ns(){let n=new URLSearchParams(location.search);["1","true"].includes(n.get("darkmode"))?document.documentElement.classList.add("dark-mode"):["1","true"].includes(n.get("lightmode"))&&document.documentElement.classList.add("light-mode")}function js(n,t=!1){let e=n.querySelector(".ribbon-contents"),s=n.querySelectorAll(".ribbon-buttons input[type=checkbox]");n.dataset.closable=t.toString();let i=n.dataset.openId;if(!i){for(let r of s)if(r.checked){i=r.dataset.contentId;break}}l.hide(e.querySelectorAll(".ribbon-content")),!i&&!t&&(i=s[0].dataset.contentId,s[0].checked=!0),i?l.show([document.getElementById(i),e]):t&&n.classList.add("contents-hidden"),n.querySelector(".ribbon-buttons").addEventListener("change",Ms)}function Ms(n){l.transition(()=>{let t=n.target,e=t.closest(".ribbon"),s=e.querySelector(".ribbon-contents");if(t.checked){let i=e.dataset.openId;!e.classList.contains("contents-hidden")&&i&&(l.hide(document.getElementById(i)),e.querySelector(`.ribbon-buttons input[data-content-id="${i}"]`).checked=!1),e.dataset.openId=t.dataset.contentId,l.show([document.getElementById(t.dataset.contentId),s]),e.classList.remove("contents-hidden")}else e.dataset.closable==="true"?(e.classList.add("contents-hidden"),l.hide(s),e.dataset.openId=""):t.checked=!0},{transition:!0})}})();
//# sourceMappingURL=index.js.map
